<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Hospital Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.35.0/dist/apexcharts.css">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <style>
        :root {
            --admin-primary: #2c3e50;
            --admin-secondary: #34495e;
            --admin-accent: #3498db;
            --admin-success: #27ae60;
            --admin-warning: #f39c12;
            --admin-danger: #e74c3c;
            --admin-info: #00b894;
        }
        
        .admin-sidebar {
            background: linear-gradient(180deg, var(--admin-primary) 0%, var(--admin-secondary) 100%);
            color: white;
            min-height: 100vh;
            box-shadow: 3px 0 15px rgba(0,0,0,0.1);
        }
        
        .admin-sidebar .nav-link {
            color: rgba(255,255,255,0.9);
            padding: 12px 20px;
            margin: 5px 15px;
            border-radius: 10px;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .admin-sidebar .nav-link:hover,
        .admin-sidebar .nav-link.active {
            background: rgba(255,255,255,0.15);
            color: white;
            transform: translateX(5px);
        }
        
        .admin-sidebar .nav-link i {
            width: 20px;
            margin-right: 10px;
            font-size: 1.1rem;
        }
        
        .admin-badge {
            background: var(--admin-accent);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .admin-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s;
            border-top: 4px solid var(--admin-primary);
        }
        
        .admin-card:hover {
            transform: translateY(-5px);
        }
        
        .admin-card-header {
            background: linear-gradient(135deg, var(--admin-primary) 0%, var(--admin-secondary) 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 15px 20px;
            font-weight: 600;
        }
        
        .admin-stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
            border-left: 5px solid var(--admin-primary);
        }
        
        .admin-stat-card.warning { border-left-color: var(--admin-warning); }
        .admin-stat-card.success { border-left-color: var(--admin-success); }
        .admin-stat-card.danger { border-left-color: var(--admin-danger); }
        .admin-stat-card.info { border-left-color: var(--admin-info); }
        
        .admin-stat-icon {
            font-size: 2.5rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .admin-stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            line-height: 1.2;
        }
        
        .admin-stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-admin {
            background: linear-gradient(135deg, var(--admin-primary) 0%, var(--admin-secondary) 100%);
            border: none;
            color: white;
            padding: 10px 25px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(44, 62, 80, 0.3);
            color: white;
        }
        
        .btn-admin-outline {
            border: 2px solid var(--admin-primary);
            color: var(--admin-primary);
            background: transparent;
            padding: 8px 20px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-admin-outline:hover {
            background: var(--admin-primary);
            color: white;
        }
        
        .admin-table th {
            background: #f8f9fa;
            color: var(--admin-secondary);
            font-weight: 600;
            border-top: none;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        
        .admin-navbar {
            background: white;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            padding: 15px 0;
        }
        
        .admin-profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--admin-primary);
            object-fit: cover;
        }
        
        .notification-dot {
            position: absolute;
            top: 0;
            right: 0;
            width: 10px;
            height: 10px;
            background: var(--admin-danger);
            border-radius: 50%;
        }
        
        .system-health-good {
            color: var(--admin-success);
            font-weight: 600;
        }
        
        .system-health-warning {
            color: var(--admin-warning);
            font-weight: 600;
        }
        
        .system-health-danger {
            color: var(--admin-danger);
            font-weight: 600;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .metric-card .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .metric-card .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .metric-card .metric-change {
            font-size: 0.85rem;
            margin-top: 10px;
        }
        
        .metric-card.success {
            background: linear-gradient(135deg, var(--admin-success) 0%, #1e8449 100%);
        }
        
        .metric-card.warning {
            background: linear-gradient(135deg, var(--admin-warning) 0%, #b9770e 100%);
        }
        
        .metric-card.danger {
            background: linear-gradient(135deg, var(--admin-danger) 0%, #c0392b 100%);
        }
        
        .metric-card.info {
            background: linear-gradient(135deg, var(--admin-info) 0%, #0984e3 100%);
        }
        
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .recent-activity-item {
            padding: 15px;
            border-left: 4px solid var(--admin-primary);
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .recent-activity-item.success {
            border-left-color: var(--admin-success);
        }
        
        .recent-activity-item.warning {
            border-left-color: var(--admin-warning);
        }
        
        .recent-activity-item.danger {
            border-left-color: var(--admin-danger);
        }
        
        .recent-activity-item.info {
            border-left-color: var(--admin-info);
        }
        
        .activity-time {
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .system-alert {
            border-left: 4px solid var(--admin-warning);
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .system-alert.danger {
            border-left-color: var(--admin-danger);
            background: #f8d7da;
            color: #721c24;
        }
        
        .system-alert.success {
            border-left-color: var(--admin-success);
            background: #d4edda;
            color: #155724;
        }
        
        .permission-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--admin-success);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .backup-status {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .backup-status.completed {
            background: #d4edda;
            border-left: 4px solid var(--admin-success);
        }
        
        .backup-status.failed {
            background: #f8d7da;
            border-left: 4px solid var(--admin-danger);
        }
        
        .backup-status.in-progress {
            background: #d1ecf1;
            border-left: 4px solid var(--admin-info);
        }
        
        .api-key-display {
            background: #f8f9fa;
            border: 1px dashed #dee2e6;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            word-break: break-all;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .admin-sidebar {
                min-height: auto;
                margin-bottom: 20px;
            }
            
            .admin-stat-card {
                margin-bottom: 20px;
            }
            
            .quick-stats {
                grid-template-columns: 1fr;
            }
        }
        
        .tab-content {
            padding: 20px 0;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
            font-weight: 500;
            padding: 10px 20px;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--admin-primary);
            border-bottom: 3px solid var(--admin-primary);
            background: transparent;
        }
        
        .setting-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .setting-group h5 {
            color: var(--admin-primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }
        
        .user-role-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .user-role-badge.admin {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .user-role-badge.doctor {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .user-role-badge.nurse {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .user-role-badge.staff {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .user-role-badge.patient {
            background: #e0f2f1;
            color: #00796b;
        }
        
        .user-status-active {
            color: var(--admin-success);
            font-weight: 600;
        }
        
        .user-status-inactive {
            color: var(--admin-danger);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Admin Sidebar -->
            <div class="col-lg-2 col-md-3 admin-sidebar">
                <div class="d-flex flex-column align-items-center py-4">
                    <img src="https://ui-avatars.com/api/?name=Admin+User&background=2c3e50&color=fff&size=80" 
                         alt="Profile" class="admin-profile-img mb-3" style="width: 80px; height: 80px;">
                    <h5 id="adminName" class="mb-1">Admin User</h5>
                    <small class="text-light mb-3" id="adminEmail">admin@hms.com</small>
                    <div class="admin-badge">SUPER ADMINISTRATOR</div>
                </div>
                
                <nav class="nav flex-column">
                    <a class="nav-link active" href="#" data-section="overview">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a class="nav-link" href="#" data-section="users">
                        <i class="fas fa-users-cog"></i> User Management
                    </a>
                    <a class="nav-link" href="#" data-section="system-settings">
                        <i class="fas fa-cogs"></i> System Settings
                    </a>
                    <a class="nav-link" href="#" data-section="permissions">
                        <i class="fas fa-user-shield"></i> Permissions
                    </a>
                    <a class="nav-link" href="#" data-section="backups">
                        <i class="fas fa-database"></i> Backups
                        <span class="badge bg-warning rounded-pill float-end" id="backupCount">2</span>
                    </a>
                    <a class="nav-link" href="#" data-section="logs">
                        <i class="fas fa-clipboard-list"></i> System Logs
                        <span class="badge bg-info rounded-pill float-end" id="logCount">24</span>
                    </a>
                    <a class="nav-link" href="#" data-section="email-templates">
                        <i class="fas fa-envelope"></i> Email Templates
                    </a>
                    <a class="nav-link" href="#" data-section="api-keys">
                        <i class="fas fa-key"></i> API Keys
                        <span class="badge bg-success rounded-pill float-end" id="apiKeyCount">3</span>
                    </a>
                    <a class="nav-link" href="#" data-section="reports">
                        <i class="fas fa-chart-bar"></i> Reports & Analytics
                    </a>
                    <a class="nav-link" href="#" data-section="maintenance">
                        <i class="fas fa-tools"></i> Maintenance
                    </a>
                    <a class="nav-link" href="#" data-section="system-health">
                        <i class="fas fa-heartbeat"></i> System Health
                    </a>
                    <div class="mt-4"></div>
                    <a class="nav-link" href="#" data-section="profile">
                        <i class="fas fa-user-cog"></i> Profile
                    </a>
                    <a class="nav-link text-warning" href="#" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </nav>
                
                <div class="mt-5 px-3">
                    <div class="system-alert">
                        <small>
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>System Alert:</strong> 2 users pending activation
                        </small>
                    </div>
                    
                    <div class="alert alert-light mt-3">
                        <small>
                            <i class="fas fa-info-circle text-primary"></i>
                            <strong>Last Backup:</strong> 2 hours ago
                        </small>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-10 col-md-9 p-0">
                <!-- Navbar -->
                <nav class="navbar navbar-expand-lg navbar-light admin-navbar">
                    <div class="container-fluid">
                        <div class="d-flex align-items-center">
                            <button class="btn btn-admin-outline me-3 d-lg-none" id="sidebarToggle">
                                <i class="fas fa-bars"></i>
                            </button>
                            <h4 class="mb-0" id="pageTitle">Admin Dashboard</h4>
                        </div>
                        
                        <div class="d-flex align-items-center">
                            <!-- System Status -->
                            <div class="d-none d-md-flex me-4">
                                <div class="me-3 text-end">
                                    <small class="text-muted d-block">System Status</small>
                                    <strong class="system-health-good">✓ Healthy</strong>
                                </div>
                                <div class="me-3 text-end">
                                    <small class="text-muted d-block">Active Users</small>
                                    <strong class="text-success">42 Online</strong>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted d-block">Uptime</small>
                                    <strong>99.8%</strong>
                                </div>
                            </div>
                            
                            <!-- Notifications -->
                            <div class="dropdown me-3">
                                <button class="btn btn-outline-primary position-relative" type="button" 
                                        data-bs-toggle="dropdown">
                                    <i class="fas fa-bell"></i>
                                    <span class="notification-dot"></span>
                                </button>
                                <div class="dropdown-menu dropdown-menu-end" style="width: 300px;">
                                    <h6 class="dropdown-header">System Alerts</h6>
                                    <div id="systemAlerts">
                                        <a class="dropdown-item" href="#">
                                            <small><strong>Low disk space</strong> - 85% used</small>
                                            <small class="text-muted d-block">1 hour ago</small>
                                        </a>
                                        <a class="dropdown-item" href="#">
                                            <small><strong>Failed login attempt</strong> - 192.168.1.100</small>
                                            <small class="text-muted d-block">2 hours ago</small>
                                        </a>
                                        <a class="dropdown-item" href="#">
                                            <small><strong>Backup completed</strong> - Database backup</small>
                                            <small class="text-muted d-block">3 hours ago</small>
                                        </a>
                                    </div>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item text-center" href="#">
                                        <small>View All Alerts</small>
                                    </a>
                                </div>
                            </div>
                            
                            <!-- User Menu -->
                            <div class="dropdown">
                                <button class="btn btn-outline-primary dropdown-toggle d-flex align-items-center" 
                                        type="button" data-bs-toggle="dropdown">
                                    <img src="https://ui-avatars.com/api/?name=Admin+User&background=2c3e50&color=fff&size=40" 
                                         alt="Profile" class="admin-profile-img me-2">
                                    <div class="text-start">
                                        <small class="d-block" id="userName">Admin User</small>
                                        <small class="text-muted">Super Administrator</small>
                                    </div>
                                </button>
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a class="dropdown-item" href="#" data-section="profile">
                                        <i class="fas fa-user me-2"></i>My Profile
                                    </a>
                                    <a class="dropdown-item" href="#" data-section="settings">
                                        <i class="fas fa-cog me-2"></i>Settings
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item text-danger" href="#" onclick="logout()">
                                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
                
                <!-- Main Content Area -->
                <div class="p-4">
                    <!-- Overview Dashboard -->
                    <div id="overviewSection" class="dashboard-section">
                        <!-- System Health Banner -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="admin-card">
                                    <div class="admin-card-header d-flex justify-content-between align-items-center">
                                        <span><i class="fas fa-heartbeat me-2"></i>System Health Dashboard</span>
                                        <span class="badge bg-success">All Systems Operational</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="text-center">
                                                    <div class="admin-stat-number system-health-good">99.8%</div>
                                                    <div class="admin-stat-label">Uptime</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="text-center">
                                                    <div class="admin-stat-number">42</div>
                                                    <div class="admin-stat-label">Active Users</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="text-center">
                                                    <div class="admin-stat-number">1.2s</div>
                                                    <div class="admin-stat-label">Avg Response Time</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="text-center">
                                                    <div class="admin-stat-number">0</div>
                                                    <div class="admin-stat-label">Active Issues</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Stats -->
                        <div class="quick-stats mb-4">
                            <div class="metric-card">
                                <div class="metric-value" id="totalUsers">1,247</div>
                                <div class="metric-label">Total Users</div>
                                <div class="metric-change">
                                    <i class="fas fa-arrow-up text-success"></i> 12% from last month
                                </div>
                            </div>
                            <div class="metric-card success">
                                <div class="metric-value" id="totalPatients">892</div>
                                <div class="metric-label">Total Patients</div>
                                <div class="metric-change">
                                    <i class="fas fa-arrow-up text-light"></i> 8% from last month
                                </div>
                            </div>
                            <div class="metric-card warning">
                                <div class="metric-value" id="todayAppointments">42</div>
                                <div class="metric-label">Today's Appointments</div>
                                <div class="metric-change">
                                    <i class="fas fa-arrow-down text-light"></i> 2% from yesterday
                                </div>
                            </div>
                            <div class="metric-card info">
                                <div class="metric-value" id="monthlyRevenue">$124,580</div>
                                <div class="metric-label">Monthly Revenue</div>
                                <div class="metric-change">
                                    <i class="fas fa-arrow-up text-light"></i> 15% from last month
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <!-- System Metrics -->
                            <div class="col-lg-8">
                                <div class="admin-card mb-4">
                                    <div class="admin-card-header">
                                        <i class="fas fa-chart-line me-2"></i>System Performance
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <div id="performanceChart"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="admin-card h-100">
                                            <div class="admin-card-header">
                                                <i class="fas fa-users me-2"></i>User Growth
                                            </div>
                                            <div class="card-body">
                                                <div class="chart-container">
                                                    <div id="userGrowthChart"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="admin-card h-100">
                                            <div class="admin-card-header">
                                                <i class="fas fa-money-bill-wave me-2"></i>Revenue Trend
                                            </div>
                                            <div class="card-body">
                                                <div class="chart-container">
                                                    <div id="revenueChart"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Recent Activity & Alerts -->
                            <div class="col-lg-4">
                                <div class="admin-card mb-4">
                                    <div class="admin-card-header d-flex justify-content-between align-items-center">
                                        <span><i class="fas fa-history me-2"></i>Recent Activity</span>
                                        <button class="btn btn-sm btn-light" onclick="loadSection('logs')">
                                            View All
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div id="recentActivity">
                                            <!-- Activity items will be loaded here -->
                                            <div class="text-center py-4">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="admin-card">
                                    <div class="admin-card-header d-flex justify-content-between align-items-center">
                                        <span><i class="fas fa-exclamation-triangle me-2"></i>System Alerts</span>
                                        <span class="badge bg-danger" id="alertCount">3</span>
                                    </div>
                                    <div class="card-body">
                                        <div id="systemAlertsList">
                                            <div class="system-alert">
                                                <strong><i class="fas fa-database text-warning me-2"></i>Database Backup</strong>
                                                <p class="mb-1">Last backup was 2 hours ago</p>
                                                <small class="activity-time">Just now</small>
                                            </div>
                                            <div class="system-alert danger">
                                                <strong><i class="fas fa-shield-alt text-danger me-2"></i>Security Alert</strong>
                                                <p class="mb-1">Multiple failed login attempts detected</p>
                                                <small class="activity-time">2 hours ago</small>
                                            </div>
                                            <div class="system-alert">
                                                <strong><i class="fas fa-server text-info me-2"></i>System Update</strong>
                                                <p class="mb-1">System update available</p>
                                                <small class="activity-time">5 hours ago</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Management Section -->
                    <div id="usersSection" class="dashboard-section" style="display: none;">
                        <div class="admin-card">
                            <div class="admin-card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-users-cog me-2"></i>User Management</span>
                                <button class="btn btn-admin" onclick="addUser()">
                                    <i class="fas fa-user-plus me-2"></i>Add User
                                </button>
                            </div>
                            <div class="card-body">
                                <!-- Filters -->
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <select class="form-select" id="userRoleFilter">
                                            <option value="">All Roles</option>
                                            <option value="admin">Admin</option>
                                            <option value="doctor">Doctor</option>
                                            <option value="nurse">Nurse</option>
                                            <option value="staff">Staff</option>
                                            <option value="patient">Patient</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="userStatusFilter">
                                            <option value="">All Status</option>
                                            <option value="active">Active</option>
                                            <option value="inactive">Inactive</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="userSearch" placeholder="Search users...">
                                            <button class="btn btn-outline-primary" onclick="searchUsers()">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Users Table -->
                                <div class="table-responsive">
                                    <table class="table admin-table" id="usersTable">
                                        <thead>
                                            <tr>
                                                <th>User ID</th>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Role</th>
                                                <th>Status</th>
                                                <th>Last Login</th>
                                                <th>Created</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="usersTableBody">
                                            <tr>
                                                <td colspan="8" class="text-center">Loading users...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Pagination -->
                                <nav aria-label="User pagination">
                                    <ul class="pagination justify-content-center" id="userPagination">
                                        <li class="page-item disabled">
                                            <a class="page-link" href="#">Previous</a>
                                        </li>
                                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                                        <li class="page-item">
                                            <a class="page-link" href="#">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Settings Section -->
                    <div id="systemSettingsSection" class="dashboard-section" style="display: none;">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <i class="fas fa-cogs me-2"></i>System Settings
                            </div>
                            <div class="card-body">
                                <ul class="nav nav-tabs" id="settingsTabs">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-bs-toggle="tab" href="#generalSettings">General</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#emailSettings">Email</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#securitySettings">Security</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#billingSettings">Billing</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#backupSettings">Backup</a>
                                    </li>
                                </ul>
                                
                                <div class="tab-content">
                                    <!-- General Settings -->
                                    <div class="tab-pane fade show active" id="generalSettings">
                                        <form id="generalSettingsForm">
                                            <div class="setting-group">
                                                <h5>Hospital Information</h5>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Hospital Name</label>
                                                        <input type="text" class="form-control" id="hospitalName" value="General Hospital">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Hospital Phone</label>
                                                        <input type="text" class="form-control" id="hospitalPhone" value="(555) 123-4567">
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Hospital Address</label>
                                                    <textarea class="form-control" id="hospitalAddress" rows="2">123 Medical Center Dr, Anytown, USA</textarea>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Hospital Email</label>
                                                        <input type="email" class="form-control" id="hospitalEmail" value="info@hospital.com">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Website</label>
                                                        <input type="url" class="form-control" id="hospitalWebsite" value="https://hospital.com">
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="setting-group">
                                                <h5>System Configuration</h5>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Time Zone</label>
                                                        <select class="form-select" id="systemTimezone">
                                                            <option value="America/New_York" selected>Eastern Time (ET)</option>
                                                            <option value="America/Chicago">Central Time (CT)</option>
                                                            <option value="America/Denver">Mountain Time (MT)</option>
                                                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Date Format</label>
                                                        <select class="form-select" id="dateFormat">
                                                            <option value="MM/DD/YYYY" selected>MM/DD/YYYY</option>
                                                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Time Format</label>
                                                        <select class="form-select" id="timeFormat">
                                                            <option value="12h" selected>12-hour</option>
                                                            <option value="24h">24-hour</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Language</label>
                                                        <select class="form-select" id="systemLanguage">
                                                            <option value="en" selected>English</option>
                                                            <option value="es">Spanish</option>
                                                            <option value="fr">French</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <button type="submit" class="btn btn-admin">
                                                <i class="fas fa-save me-2"></i>Save General Settings
                                            </button>
                                        </form>
                                    </div>
                                    
                                    <!-- Email Settings -->
                                    <div class="tab-pane fade" id="emailSettings">
                                        <form id="emailSettingsForm">
                                            <div class="setting-group">
                                                <h5>SMTP Configuration</h5>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">SMTP Host</label>
                                                        <input type="text" class="form-control" id="smtpHost" value="smtp.gmail.com">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">SMTP Port</label>
                                                        <input type="number" class="form-control" id="smtpPort" value="587">
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">SMTP Username</label>
                                                        <input type="text" class="form-control" id="smtpUsername" value="noreply@hospital.com">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">SMTP Password</label>
                                                        <input type="password" class="form-control" id="smtpPassword" placeholder="••••••••">
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Encryption</label>
                                                        <select class="form-select" id="smtpEncryption">
                                                            <option value="tls" selected>TLS</option>
                                                            <option value="ssl">SSL</option>
                                                            <option value="none">None</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">From Email</label>
                                                        <input type="email" class="form-control" id="fromEmail" value="noreply@hospital.com">
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="setting-group">
                                                <h5>Email Notifications</h5>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="enableEmailNotifications" checked>
                                                    <label class="form-check-label" for="enableEmailNotifications">
                                                        Enable email notifications
                                                    </label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="sendWelcomeEmail" checked>
                                                    <label class="form-check-label" for="sendWelcomeEmail">
                                                        Send welcome email to new users
                                                    </label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="sendAppointmentReminders" checked>
                                                    <label class="form-check-label" for="sendAppointmentReminders">
                                                        Send appointment reminders
                                                    </label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="sendBillingNotifications" checked>
                                                    <label class="form-check-label" for="sendBillingNotifications">
                                                        Send billing notifications
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <button type="submit" class="btn btn-admin">
                                                <i class="fas fa-save me-2"></i>Save Email Settings
                                            </button>
                                        </form>
                                    </div>
                                    
                                    <!-- Security Settings -->
                                    <div class="tab-pane fade" id="securitySettings">
                                        <form id="securitySettingsForm">
                                            <div class="setting-group">
                                                <h5>Authentication</h5>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Session Timeout (minutes)</label>
                                                        <input type="number" class="form-control" id="sessionTimeout" value="30" min="5" max="240">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Max Login Attempts</label>
                                                        <input type="number" class="form-control" id="maxLoginAttempts" value="5" min="1" max="10">
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Lockout Duration (minutes)</label>
                                                        <input type="number" class="form-control" id="lockoutDuration" value="15" min="1" max="1440">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Two-Factor Authentication</label>
                                                        <select class="form-select" id="twoFactorAuth">
                                                            <option value="optional">Optional</option>
                                                            <option value="required_admin">Required for Admins</option>
                                                            <option value="required_all">Required for All</option>
                                                            <option value="disabled" selected>Disabled</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="setting-group">
                                                <h5>Password Policy</h5>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="requireStrongPasswords" checked>
                                                    <label class="form-check-label" for="requireStrongPasswords">
                                                        Require strong passwords
                                                    </label>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Minimum Password Length</label>
                                                        <input type="number" class="form-control" id="minPasswordLength" value="8" min="6" max="32">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Password Expiry (days)</label>
                                                        <input type="number" class="form-control" id="passwordExpiry" value="90" min="0" max="365">
                                                        <small class="text-muted">0 = Never expire</small>
                                                    </div>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="requireUppercase" checked>
                                                    <label class="form-check-label" for="requireUppercase">
                                                        Require uppercase letters
                                                    </label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="requireLowercase" checked>
                                                    <label class="form-check-label" for="requireLowercase">
                                                        Require lowercase letters
                                                    </label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="requireNumbers" checked>
                                                    <label class="form-check-label" for="requireNumbers">
                                                        Require numbers
                                                    </label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="requireSpecialChars">
                                                    <label class="form-check-label" for="requireSpecialChars">
                                                        Require special characters
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <div class="setting-group">
                                                <h5>IP Security</h5>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="enableIpWhitelist">
                                                    <label class="form-check-label" for="enableIpWhitelist">
                                                        Enable IP whitelist
                                                    </label>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Allowed IP Addresses</label>
                                                    <textarea class="form-control" id="allowedIps" rows="3" placeholder="Enter one IP per line"></textarea>
                                                    <small class="text-muted">Leave empty to allow all IPs</small>
                                                </div>
                                            </div>
                                            
                                            <button type="submit" class="btn btn-admin">
                                                <i class="fas fa-save me-2"></i>Save Security Settings
                                            </button>
                                        </form>
                                    </div>
                                    
                                    <!-- Billing Settings -->
                                    <div class="tab-pane fade" id="billingSettings">
                                        <form id="billingSettingsForm">
                                            <div class="setting-group">
                                                <h5>Currency & Payments</h5>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Currency</label>
                                                        <select class="form-select" id="currency">
                                                            <option value="USD" selected>US Dollar (USD)</option>
                                                            <option value="EUR">Euro (EUR)</option>
                                                            <option value="GBP">British Pound (GBP)</option>
                                                            <option value="CAD">Canadian Dollar (CAD)</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Currency Symbol</label>
                                                        <input type="text" class="form-control" id="currencySymbol" value="$" maxlength="3">
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Tax Rate (%)</label>
                                                        <input type="number" class="form-control" id="taxRate" value="7.5" step="0.1" min="0" max="50">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Invoice Due Days</label>
                                                        <input type="number" class="form-control" id="invoiceDueDays" value="30" min="1" max="90">
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="setting-group">
                                                <h5>Payment Gateway</h5>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Payment Gateway</label>
                                                        <select class="form-select" id="paymentGateway">
                                                            <option value="stripe" selected>Stripe</option>
                                                            <option value="paypal">PayPal</option>
                                                            <option value="authorize">Authorize.net</option>
                                                            <option value="offline">Offline Payments Only</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Test Mode</label>
                                                        <select class="form-select" id="paymentTestMode">
                                                            <option value="true">Enabled</option>
                                                            <option value="false" selected>Disabled</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Stripe Public Key</label>
                                                        <input type="text" class="form-control" id="stripePublicKey" placeholder="pk_test_...">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Stripe Secret Key</label>
                                                        <input type="password" class="form-control" id="stripeSecretKey" placeholder="sk_test_...">
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="setting-group">
                                                <h5>Billing Features</h5>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="enableOnline                                                     <input class="form-check-input" type="checkbox" id="enableOnlinePayments" checked>
                                                    <label class="form-check-label" for="enableOnlinePayments">
                                                        Enable online payments
                                                    </label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="enableInvoiceGeneration" checked>
                                                    <label class="form-check-label" for="enableInvoiceGeneration">
                                                        Enable automatic invoice generation
                                                    </label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="enablePaymentReminders" checked>
                                                    <label class="form-check-label" for="enablePaymentReminders">
                                                        Enable payment reminders
                                                    </label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="enableLateFees">
                                                    <label class="form-check-label" for="enableLateFees">
                                                        Enable late payment fees
                                                    </label>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Late Fee Percentage</label>
                                                        <input type="number" class="form-control" id="lateFeePercentage" value="5" min="0" max="50">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Late Fee Grace Period (days)</label>
                                                        <input type="number" class="form-control" id="lateFeeGracePeriod" value="7" min="1" max="30">
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <button type="submit" class="btn btn-admin">
                                                <i class="fas fa-save me-2"></i>Save Billing Settings
                                            </button>
                                        </form>
                                    </div>
                                    
                                    <!-- Backup Settings -->
                                    <div class="tab-pane fade" id="backupSettings">
                                        <form id="backupSettingsForm">
                                            <div class="setting-group">
                                                <h5>Backup Configuration</h5>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Backup Frequency</label>
                                                        <select class="form-select" id="backupFrequency">
                                                            <option value="daily" selected>Daily</option>
                                                            <option value="weekly">Weekly</option>
                                                            <option value="monthly">Monthly</option>
                                                            <option value="manual">Manual Only</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Backup Time</label>
                                                        <input type="time" class="form-control" id="backupTime" value="02:00">
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Retain Backups (days)</label>
                                                        <input type="number" class="form-control" id="backupRetention" value="30" min="1" max="365">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Max Backup Size (MB)</label>
                                                        <input type="number" class="form-control" id="maxBackupSize" value="500" min="10" max="5000">
                                                    </div>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="compressBackups" checked>
                                                    <label class="form-check-label" for="compressBackups">
                                                        Compress backups
                                                    </label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="backupDatabase" checked>
                                                    <label class="form-check-label" for="backupDatabase">
                                                        Backup database
                                                    </label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="backupFiles">
                                                    <label class="form-check-label" for="backupFiles">
                                                        Backup uploaded files
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <div class="setting-group">
                                                <h5>Backup Location</h5>
                                                <div class="mb-3">
                                                    <label class="form-label">Local Backup Path</label>
                                                    <input type="text" class="form-control" id="localBackupPath" value="/backups/" readonly>
                                                    <small class="text-muted">Backups are stored locally on the server</small>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="enableCloudBackup">
                                                    <label class="form-check-label" for="enableCloudBackup">
                                                        Enable cloud backup (AWS S3)
                                                    </label>
                                                </div>
                                                <div class="row" id="cloudBackupSettings" style="display: none;">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">AWS Access Key</label>
                                                        <input type="text" class="form-control" id="awsAccessKey" placeholder="AKIA...">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">AWS Secret Key</label>
                                                        <input type="password" class="form-control" id="awsSecretKey" placeholder="••••••••">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">S3 Bucket Name</label>
                                                        <input type="text" class="form-control" id="s3BucketName" placeholder="hospital-backups">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">S3 Region</label>
                                                        <input type="text" class="form-control" id="s3Region" placeholder="us-east-1">
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="alert alert-warning">
                                                <i class="fas fa-exclamation-triangle me-2"></i>
                                                <strong>Important:</strong> Always verify backups are working correctly. Test restoration regularly.
                                            </div>
                                            
                                            <button type="submit" class="btn btn-admin">
                                                <i class="fas fa-save me-2"></i>Save Backup Settings
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Permissions Section -->
                    <div id="permissionsSection" class="dashboard-section" style="display: none;">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <i class="fas fa-user-shield me-2"></i>Role-Based Access Control
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="list-group" id="rolesList">
                                            <a href="#" class="list-group-item list-group-item-action active" data-role="admin">
                                                <i class="fas fa-crown me-2"></i>Administrator
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" data-role="doctor">
                                                <i class="fas fa-user-md me-2"></i>Doctor
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" data-role="nurse">
                                                <i class="fas fa-user-nurse me-2"></i>Nurse
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" data-role="staff">
                                                <i class="fas fa-user-tie me-2"></i>Staff
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" data-role="patient">
                                                <i class="fas fa-user-injured me-2"></i>Patient
                                            </a>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-9">
                                        <div id="permissionsContent">
                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                <h5 id="currentRole">Administrator Permissions</h5>
                                                <button class="btn btn-admin" onclick="savePermissions()">
                                                    <i class="fas fa-save me-2"></i>Save Permissions
                                                </button>
                                            </div>
                                            
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="setting-group">
                                                        <h6><i class="fas fa-users-cog me-2"></i>User Management</h6>
                                                        <div class="permission-toggle">
                                                            <span>Create Users</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_create_users" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>Edit Users</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_edit_users" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>Delete Users</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_delete_users" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>View Users</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_view_users" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="setting-group">
                                                        <h6><i class="fas fa-user-injured me-2"></i>Patient Management</h6>
                                                        <div class="permission-toggle">
                                                            <span>Create Patients</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_create_patients" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>Edit Patients</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_edit_patients" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>View Medical Records</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_view_medical" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>Edit Medical Records</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_edit_medical" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="col-md-6">
                                                    <div class="setting-group">
                                                        <h6><i class="fas fa-file-invoice-dollar me-2"></i>Billing & Finance</h6>
                                                        <div class="permission-toggle">
                                                            <span>Create Invoices</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_create_invoices" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>Process Payments</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_process_payments" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>View Financial Reports</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_view_financial" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>Generate Reports</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_generate_reports" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="setting-group">
                                                        <h6><i class="fas fa-cogs me-2"></i>System Access</h6>
                                                        <div class="permission-toggle">
                                                            <span>System Settings</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_system_settings" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>Backup Management</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_backup_manage" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>View System Logs</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_view_logs" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                        <div class="permission-toggle">
                                                            <span>API Access</span>
                                                            <label class="toggle-switch">
                                                                <input type="checkbox" id="perm_api_access" checked>
                                                                <span class="toggle-slider"></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Backups Section -->
                    <div id="backupsSection" class="dashboard-section" style="display: none;">
                        <div class="admin-card">
                            <div class="admin-card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-database me-2"></i>Backup Management</span>
                                <div>
                                    <button class="btn btn-admin me-2" onclick="createBackup()">
                                        <i class="fas fa-plus me-2"></i>Create Backup
                                    </button>
                                    <button class="btn btn-admin-outline" onclick="scheduleBackup()">
                                        <i class="fas fa-clock me-2"></i>Schedule Backup
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- Backup Status -->
                                <div class="row mb-4">
                                    <div class="col-md-4">
                                        <div class="admin-stat-card">
                                            <div class="admin-stat-icon text-primary">
                                                <i class="fas fa-hdd"></i>
                                            </div>
                                            <div class="admin-stat-number" id="totalBackups">24</div>
                                            <div class="admin-stat-label">Total Backups</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="admin-stat-card success">
                                            <div class="admin-stat-icon text-success">
                                                <i class="fas fa-check-circle"></i>
                                            </div>
                                            <div class="admin-stat-number" id="successfulBackups">22</div>
                                            <div class="admin-stat-label">Successful</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="admin-stat-card danger">
                                            <div class="admin-stat-icon text-danger">
                                                <i class="fas fa-times-circle"></i>
                                            </div>
                                            <div class="admin-stat-number" id="failedBackups">2</div>
                                            <div class="admin-stat-label">Failed</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Recent Backups -->
                                <h5 class="mb-3"><i class="fas fa-history me-2"></i>Recent Backups</h5>
                                <div id="backupList">
                                    <div class="backup-status completed">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>Full System Backup</strong>
                                                <div class="small">Database + Files</div>
                                                <small class="text-muted">Size: 245 MB | Type: Automatic</small>
                                            </div>
                                            <div class="text-end">
                                                <div class="text-success">Completed</div>
                                                <small class="text-muted">2 hours ago</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="backup-status failed">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>Database Backup</strong>
                                                <div class="small">Database Only</div>
                                                <small class="text-muted">Size: 85 MB | Type: Manual</small>
                                            </div>
                                            <div class="text-end">
                                                <div class="text-danger">Failed</div>
                                                <small class="text-muted">1 day ago</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="backup-status completed">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>Full System Backup</strong>
                                                <div class="small">Database + Files</div>
                                                <small class="text-muted">Size: 240 MB | Type: Automatic</small>
                                            </div>
                                            <div class="text-end">
                                                <div class="text-success">Completed</div>
                                                <small class="text-muted">1 day ago</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Backup Actions -->
                                <div class="mt-4">
                                    <h5 class="mb-3"><i class="fas fa-tools me-2"></i>Backup Actions</h5>
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <button class="btn btn-admin-outline w-100" onclick="restoreBackup()">
                                                <i class="fas fa-redo me-2"></i>Restore Backup
                                            </button>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <button class="btn btn-admin-outline w-100" onclick="downloadBackup()">
                                                <i class="fas fa-download me-2"></i>Download Backup
                                            </button>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <button class="btn btn-admin-outline w-100" onclick="deleteOldBackups()">
                                                <i class="fas fa-trash me-2"></i>Clean Old Backups
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Backup Statistics -->
                                <div class="mt-4">
                                    <h5 class="mb-3"><i class="fas fa-chart-pie me-2"></i>Backup Statistics</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="chart-container">
                                                <div id="backupSizeChart"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="chart-container">
                                                <div id="backupStatusChart"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Logs Section -->
                    <div id="logsSection" class="dashboard-section" style="display: none;">
                        <div class="admin-card">
                            <div class="admin-card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-clipboard-list me-2"></i>System Logs</span>
                                <div>
                                    <button class="btn btn-admin-outline me-2" onclick="exportLogs()">
                                        <i class="fas fa-download me-2"></i>Export Logs
                                    </button>
                                    <button class="btn btn-admin-outline" onclick="clearLogs()">
                                        <i class="fas fa-trash me-2"></i>Clear Logs
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- Log Filters -->
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <select class="form-select" id="logTypeFilter">
                                            <option value="">All Log Types</option>
                                            <option value="auth">Authentication</option>
                                            <option value="error">Error</option>
                                            <option value="system">System</option>
                                            <option value="security">Security</option>
                                            <option value="database">Database</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="logLevelFilter">
                                            <option value="">All Levels</option>
                                            <option value="info">Info</option>
                                            <option value="warning">Warning</option>
                                            <option value="error">Error</option>
                                            <option value="critical">Critical</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="date" class="form-control" id="logDateFilter">
                                    </div>
                                    <div class="col-md-3">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="logSearch" placeholder="Search logs...">
                                            <button class="btn btn-outline-primary" onclick="filterLogs()">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Logs Table -->
                                <div class="table-responsive">
                                    <table class="table admin-table" id="logsTable">
                                        <thead>
                                            <tr>
                                                <th>Timestamp</th>
                                                <th>Type</th>
                                                <th>Level</th>
                                                <th>User</th>
                                                <th>IP Address</th>
                                                <th>Message</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="logsTableBody">
                                            <tr>
                                                <td colspan="7" class="text-center">Loading logs...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Pagination -->
                                <nav aria-label="Log pagination">
                                    <ul class="pagination justify-content-center" id="logPagination">
                                        <li class="page-item disabled">
                                            <a class="page-link" href="#">Previous</a>
                                        </li>
                                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                                        <li class="page-item">
                                            <a class="page-link" href="#">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Email Templates Section -->
                    <div id="emailTemplatesSection" class="dashboard-section" style="display: none;">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <i class="fas fa-envelope me-2"></i>Email Templates
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="list-group" id="templateList">
                                            <a href="#" class="list-group-item list-group-item-action active" data-template="welcome">
                                                <i class="fas fa-user-plus me-2"></i>Welcome Email
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" data-template="password-reset">
                                                <i class="fas fa-key me-2"></i>Password Reset
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" data-template="appointment-reminder">
                                                <i class="fas fa-calendar-alt me-2"></i>Appointment Reminder
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" data-template="invoice">
                                                <i class="fas fa-file-invoice me-2"></i>Invoice Notification
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" data-template="billing">
                                                <i class="fas fa-credit-card me-2"></i>Billing Notification
                                            </a>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-8">
                                        <div id="templateEditor">
                                            <h5 id="templateTitle">Welcome Email Template</h5>
                                            <form id="emailTemplateForm">
                                                <div class="mb-3">
                                                    <label class="form-label">Subject</label>
                                                    <input type="text" class="form-control" id="emailSubject" value="Welcome to Hospital Management System">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Available Variables</label>
                                                    <div class="alert alert-info">
                                                        <small>
                                                            <code>{name}</code> - User's full name<br>
                                                            <code>{email}</code> - User's email<br>
                                                            <code>{hospital}</code> - Hospital name<br>
                                                            <code>{date}</code> - Current date<br>
                                                            <code>{username}</code> - Username<br>
                                                            <code>{password}</code> - Temporary password
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Email Content (HTML)</label>
                                                    <textarea class="form-control" id="emailContent" rows="15" style="font-family: monospace;">
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Welcome to Hospital Management System</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: #2c3e50; color: white; padding: 20px; text-align: center; }
        .content { padding: 30px; background: #f9f9f9; }
        .footer { text-align: center; padding: 20px; color: #666; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Welcome to Hospital Management System</h1>
        </div>
        <div class="content">
            <h2>Hello {name},</h2>
            <p>Your account has been created successfully at <strong>{hospital}</strong>.</p>
            <p>Here are your login credentials:</p>
            <ul>
                <li><strong>Username:</strong> {username}</li>
                <li><strong>Email:</strong> {email}</li>
                <li><strong>Temporary Password:</strong> {password}</li>
            </ul>
            <p>Please login and change your password immediately.</p>
            <p style="text-align: center;">
                <a href="https://hospital.com/login" style="background: #3498db; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px;">
                    Login to Your Account
                </a>
            </p>
        </div>
        <div class="footer">
            <p>This is an automated email from {hospital}. Please do not reply to this email.</p>
            <p>&copy; {year} {hospital}. All rights reserved.</p>
        </div>
    </div>
</body>
</html>
                                                    </textarea>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Plain Text Version</label>
                                                    <textarea class="form-control" id="plainTextContent" rows="5" placeholder="Plain text version for non-HTML email clients"></textarea>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="emailTemplateActive" checked>
                                                    <label class="form-check-label" for="emailTemplateActive">
                                                        This template is active
                                                    </label>
                                                </div>
                                                <button type="submit" class="btn btn-admin">
                                                    <i class="fas fa-save me-2"></i>Save Template
                                                </button>
                                                <button type="button" class="btn btn-admin-outline ms-2" onclick="previewEmail()">
                                                    <i class="fas fa-eye me-2"></i>Preview
                                                </button>
                                                <button type="button" class="btn btn-admin-outline ms-2" onclick="testEmail()">
                                                    <i class="fas fa-paper-plane me-2"></i>Send Test
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- API Keys Section -->
                    <div id="apiKeysSection" class="dashboard-section" style="display: none;">
                        <div class="admin-card">
                            <div class="admin-card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-key me-2"></i>API Key Management</span>
                                <button class="btn btn-admin" onclick="generateApiKey()">
                                    <i class="fas fa-plus me-2"></i>Generate New Key
                                </button>
                            </div>
                            <div class="card-body">
                                <!-- API Key Generation -->
                                <div class="setting-group mb-4">
                                    <h5>API Key Information</h5>
                                    <p class="text-muted">
                                        API keys allow external applications to interact with the Hospital Management System.
                                        Keep your keys secure and never share them publicly.
                                    </p>
                                </div>
                                
                                <!-- Active API Keys -->
                                <h5 class="mb-3">Active API Keys</h5>
                                <div id="apiKeysList">
                                    <div class="api-key-display mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>Production API Key</strong>
                                                <div class="small text-muted">Created: 2023-10-15 | Last Used: Today</div>
                                                <code>sk_prod_2c3e50a1b2c3d4e5f6g7h8i9j0k1l2m</code>
                                            </div>
                                            <div>
                                                <button class="btn btn-sm btn-admin-outline" onclick="copyApiKey(this)">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                                <button class="btn btn-sm btn-danger ms-2" onclick="revokeApiKey(this)">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="api-key-display mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>Development API Key</strong>
                                                <div class="small text-muted">Created: 2023-10-10 | Last Used: 2 days ago</div>
                                                <code>sk_dev_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p</code>
                                            </div>
                                            <div>
                                                <button class="btn btn-sm btn-admin-outline" onclick="copyApiKey(this)">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                                <button class="btn btn-sm btn-danger ms-2" onclick="revokeApiKey(this)">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- API Usage Statistics -->
                                <div class="mt-4">
                                    <h5 class="mb-3">API Usage Statistics</h5>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="admin-stat-card">
                                                <div class="admin-stat-icon text-primary">
                                                    <i class="fas fa-exchange-alt"></i>
                                                </div>
                                                <div class="admin-stat-number" id="apiRequests">1,245</div>
                                                <div class="admin-stat-label">Requests Today</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="admin-stat-card success">
                                                <div class="admin-stat-icon text-success">
                                                    <i class="fas fa-check"></i>
                                                </div>
                                                <div class="admin-stat-number" id="apiSuccess">1,198</div>
                                                <div class="admin-stat-label">Successful</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="admin-stat-card danger">
                                                <div class="admin-stat-icon text-danger">
                                                    <i class="fas fa-times"></i>
                                                </div>
                                                <div class="admin-stat-number" id="apiErrors">47</div>
                                                <div class="admin-stat-label">Errors</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="admin-stat-card warning">
                                                <div class="admin-stat-icon text-warning">
                                                    <i class="fas fa-clock"></i>
                                                </div>
                                                <div class="admin-stat-number" id="apiAvgTime">142ms</div>
                                                <div class="admin-stat-label">Avg Response</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- API Documentation -->
                                <div class="mt-4">
                                    <h5 class="mb-3">API Documentation</h5>
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <strong>API Documentation:</strong> Complete API documentation is available at 
                                        <a href="https://api.hospital.com/docs" target="_blank">https://api.hospital.com/docs</a>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="setting-group">
                                                <h6>Base URL</h6>
                                                <code>https://api.hospital.com/v1</code>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="setting-group">
                                                <h6>Authentication</h6>
                                                <code>Authorization: Bearer YOUR_API_KEY</code>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reports Section -->
                    <div id="reportsSection" class="dashboard-section" style="display: none;">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <i class="fas fa-chart-bar me-2"></i>Reports & Analytics
                            </div>
                            <div class="card-body">
                                <!-- Report Filters -->
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <label class="form-label">Report Type</label>
                                        <select class="form-select" id="reportType">
                                            <option value="financial">Financial Report</option>
                                            <option value="patient">Patient Statistics</option>
                                            <option value="appointment">Appointment Analysis</option>
                                            <option value="staff">Staff Performance</option>
                                            <option value="inventory">Inventory Report</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Period</label>
                                        <select class="form-select" id="reportPeriod">
                                            <option value="today">Today</option>
                                            <option value="week">This Week</option>
                                            <option value="month" selected>This Month</option>
                                            <option value="quarter">This Quarter</option>
                                            <option value="year">This Year</option>
                                            <option value="custom">Custom Range</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Start Date</label>
                                        <input type="date" class="form-control" id="reportStartDate">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">End Date</label>
                                        <input type="date" class="form-control" id="reportEndDate">
                                    </div>
                                </div>
                                
                                <!-- Report Actions -->
                                <div class="d-flex justify-content-end mb-4">
                                    <button class="btn btn-admin me-2" onclick="generateReport()">
                                        <i class="fas fa-chart-line me-2"></i>Generate Report
                                    </button>
                                    <button class="btn btn-admin-outline me-2" onclick="exportReport()">
                                        <i class="fas fa-file-excel me-2"></i>Export to Excel
                                    </button>
                                    <button class="btn btn-admin-outline" onclick="printReport()">
                                        <i class="fas fa-print me-2"></i>Print Report
                                    </button>
                                </div>
                                
                                <!-- Report Content -->
                                <div id="reportContent">
                                    <div class="text-center py-5">
                                        <h4 class="text-muted">Select report type and click "Generate Report"</h4>
                                        <p class="text-muted">Reports will be displayed here</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Maintenance Section -->
                    <div id="maintenanceSection" class="dashboard-section" style="display: none;">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <i class="fas fa-tools me-2"></i>System Maintenance
                            </div>
                            <div class="card-body">
                                <div class="alert alert-warning mb-4">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>Warning:</strong> Maintenance operations may affect system availability. 
                                    Schedule maintenance during off-peak hours.
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="setting-group">
                                            <h5><i class="fas fa-database me-2"></i>Database Maintenance</h5>
                                            <div class="mb-3">
                                                <button class="btn btn-admin-outline w-100 mb-2" onclick="optimizeDatabase()">
                                                    <i class="fas fa-broom me-2"></i>Optimize Database
                                                </button>
                                                <small class="text-muted">Optimize tables and repair indexes</small>
                                            </div>
                                            <div class="mb-3">
                                                <button class="btn btn-admin-outline w-100 mb-2" onclick="clearCache()">
                                                    <i class="fas fa-trash-alt me-2"></i>Clear System Cache
                                                </button>
                                                <small class="text-muted">Clear all cached data</small>
                                            </div>
                                            <div class="mb-3">
                                                <button class="btn btn-admin-outline w-100 mb-2" onclick="updateStatistics()">
                                                    <i class="fas fa-chart-bar me-2"></i>Update Statistics
                                                </button>
                                                <small class="text-muted">Update database statistics for better performance</small>
                                            </div>
                                        </div>
                                        
                                        <div class="setting-group">
                                            <h5><i class="fas fa-server me-2"></i>System Updates</h5>
                                            <div id="updateStatus">
                                                <div class="alert alert-info">
                                                    <i class="fas fa-info-circle me-2"></i>
                                                    <strong>System Update Available</strong>
                                                    <p class="mb-1">Version 2.1.0 is available</p>
                                                    <small class="text-muted">Current version: 2.0.5</small>
                                                </div>
                                            </div>
                                            <button class="btn btn-admin w-100" onclick="checkForUpdates()">
                                                <i class="fas fa-sync-alt me-2"></i>Check for Updates
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="setting-group">
                                            <h5><i class="fas fa-cogs me-2"></i>System Health Checks</h5>
                                            <div id="healthCheckResults">
                                                <div class="alert alert-success mb-2">
                                                    <i class="fas fa-check-circle me-2"></i>
                                                    Database Connection: <strong>OK</strong>
                                                </div>
                                                <div class="alert alert-success mb-2">
                                                    <i class="fas fa-check-circle me-2"></i>
                                                    File Permissions: <strong>OK</strong>
                                                </div>
                                                <div class="alert alert-warning mb-2">
                                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                                    Disk Space: <strong>85% used</strong>
                                                </div>
                                                <div class="alert alert-success mb-2">
                                                    <i class="fas fa-check-circle me-2"></i>
                                                    Email Service: <strong>OK</strong>
                                                </div>
                                            </div>
                                            <button class="btn btn-admin w-100" onclick="runHealthChecks()">
                                                <i class="fas fa-stethoscope me-2"></i>Run Health Checks
                                            </button>
                                        </div>
                                        
                                        <div class="setting-group">
                                            <h5><i class="fas fa-exclamation-triangle me-2"></i>System Maintenance Mode</h5>
                                            <div class="alert alert-danger">
                                                <i class="fas fa-power-off me-2"></i>
                                                <strong>Maintenance Mode</strong>
                                                <p class="mb-2">When enabled, only administrators can access the system.</p>
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="maintenanceMode">
                                                    <label class="form-check-label" for="maintenanceMode">
                                                        Enable Maintenance Mode
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Maintenance Message</label>
                                                <textarea class="form-control" id="maintenanceMessage" rows="3" placeholder="System is undergoing maintenance. Please check back later."></textarea>
                                            </div>
                                            <button class="btn btn-admin w-100" onclick="updateMaintenanceMode()">
                                                <i class="fas fa-save me-2"></i>Update Maintenance Settings
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Health Section -->
                    <div id="systemHealthSection" class="dashboard-section" style="display: none;">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <i class="fas fa-heartbeat me-2"></i>System Health Monitor
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="chart-container mb-4">
                                            <div id="systemHealthChart"></div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="admin-stat-card">
                                                    <div class="admin-stat-icon text-primary">
                                                        <i class="fas fa-tachometer-alt"></i>
                                                    </div>
                                                    <div class="admin-stat-number" id="cpuUsage">45%</div>
                                                    <div class="admin-stat-label">CPU Usage</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="admin-stat-card warning">
                                                    <div class="admin-stat-icon text-warning">
                                                        <i class="fas fa-memory"></i>
                                                    </div>
                                                    <div class="admin-stat-number" id="memoryUsage">68%</div>
                                                    <div class="admin-stat-label">Memory Usage</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4">
                                        <div class="setting-group">
                                            <h5><i class="fas fa-shield-alt me-2"></i>Security Status</h5>
                                            <div class="alert alert-success mb-2">
                                                <i class="fas fa-check-circle me-2"></i>
                                                SSL Certificate: <strong>Valid</strong>
                                            </div>
                                            <div class="alert alert-success mb-2">
                                                <i class="fas fa-check-circle me-2"></i>
                                                Firewall: <strong>Active</strong>
                                            </div>
                                            <div class="alert alert-warning mb-2">
                                                <i class="fas fa-exclamation-triangle me-2"></i>
                                                Last Security Scan: <strong>2 days ago</strong>
                                            </div>
                                            <button class="btn btn-admin-outline w-100" onclick="runSecurityScan()">
                                                <i class="fas fa-shield-alt me-2"></i>Run Security Scan
                                            </button>
                                        </div>
                                        
                                        <div class="setting-group mt-4">
                                            <h5><i class="fas fa-clock me-2"></i>Uptime Monitor</h5>
                                            <div class="text-center">
                                                <div class="admin-stat-number system-health-good">99.8%</div>
                                                <div class="admin-stat-label">Uptime (Last 30 Days)</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Service Status -->
                                <div class="mt-4">
                                    <h5 class="mb-3"><i class="fas fa-server me-2"></i>Service Status</h5>
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <div class="alert alert-success h-100">
                                                <i class="fas fa-check-circle me-2"></i>
                                                <strong>Web Server</strong>
                                                <p class="mb-0">Running</p>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="alert alert-success h-100">
                                                <i class="fas fa-check-circle me-2"></i>
                                                <strong>Database</strong>
                                                <p class="mb-0">Running</p>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="alert alert-warning h-100">
                                                <i class="fas fa-exclamation-triangle me-2"></i>
                                                <strong>Email Service</strong>
                                                <p class="mb-0">High Load</p>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="alert alert-success h-100">
                                                <i class="fas fa-check-circle me-2"></i>
                                                <strong>Backup Service</strong>
                                                <p class="mb-0">Running</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Profile Section -->
                    <div id="profileSection" class="dashboard-section" style="display: none;">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="admin-card">
                                    <div class="admin-card-header">
                                        <i class="fas fa-user-circle me-2"></i>Profile Picture
                                    </div>
                                    <div class="card-body text-center">
                                        <img src="https://ui-avatars.com/api/?name=Admin+User&background=2c3e50&color=fff&size=200" 
                                             alt="Profile" class="admin-profile-img mb-3" style="width: 200px; height: 200px;">
                                        <input type="file" class="form-control mb-3" id="profilePicture" accept="image/*">
                                        <button class="btn btn-admin w-100" onclick="updateProfilePicture()">
                                            <i class="fas fa-upload me-2"></i>Update Picture
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="admin-card mt-4">
                                    <div class="admin-card-header">
                                        <i class="fas fa-shield-alt me-2"></i>Security
                                    </div>
                                    <div class="card-body">
                                        <button class="btn btn-admin-outline w-100 mb-2" onclick="changePassword()">
                                            <i class="fas fa-key me-2"></i>Change Password
                                        </button>
                                        <button class="btn btn-admin-outline w-100" onclick="enableTwoFactor()">
                                            <i class="fas fa-mobile-alt me-2"></i>Two-Factor Authentication
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-8">
                                <div class="admin-card">
                                    <div class="admin-card-header">
                                        <i class="fas fa-user-edit me-2"></i>Edit Profile
                                    </div>
                                    <div class="card-body">
                                        <form id="profileForm">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">First Name</label>
                                                    <input type="text" class="form-control" id="profileFirstName" value="Admin">
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Last Name</label>
                                                    <input type="text" class="form-control" id="profileLastName" value="User">
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Email</label>
                                                    <input type="email" class="form-control" id="profileEmail" value="admin@hms.com">
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Phone</label>
                                                    <input type="tel" class="form-control" id="profilePhone" value="(555) 123-4567">
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Address</label>
                                                <textarea class="form-control" id="profileAddress" rows="3">123 Admin Street, Suite 100</textarea>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Timezone</label>
                                                    <select class="form-select" id="profileTimezone">
                                                        <option value="America/New_York" selected>Eastern Time (ET)</option>
                                                        <option value="America/Chicago">Central Time (CT)</option>
                                                        <option value="America/Denver">Mountain Time (MT)</option>
                                                        <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label">Language</label>
                                                    <select class="form-select" id="profileLanguage">
                                                        <option value="en" selected>English</option>
                                                        <option value="es">Spanish</option>
                                                        <option value="fr">French</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-admin">
                                                <i class="fas fa-save me-2"></i>Update Profile
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                
                                <div class="admin-card mt-4">
                                    <div class="admin-card-header">
                                        <i class="fas fa-history me-2"></i>Recent Activity
                                    </div>
                                    <div class="card-body">
                                        <div id="userActivity">
                                            <div class="recent-activity-item">
                                                <strong>Changed password</strong>
                                                <p class="mb-1">Password updated successfully</p>
                                                <small class="activity-time">2 hours ago</small>
                                            </div>
                                            <div class="recent-activity-item success">
                                                <strong>System login</strong>
                                                <p class="mb-1">Logged in from Chrome on Windows</p>
                                                <small class="activity-time">4 hours ago</small>
                                            </div>
                                            <div class="recent-activity-item info">
                                                <strong>Profile updated</strong>
                                                <p class="mb-1">Updated personal information</p>
                                                <small class="activity-time">1 day ago</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.35.0/dist/apexcharts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../../assets/js/api.js"></script>
    
    <script>
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadDashboardData();
            setupEventListeners();
            
            // Check for system alerts
            checkSystemAlerts();
            
            // Update timestamp every minute
            setInterval(updateTimestamps, 60000);
        });

        // Initialize ApexCharts
        function initializeCharts() {
            // Performance Chart
            window.performanceChart = new ApexCharts(document.querySelector("#performanceChart"), {
                series: [{
                    name: 'Response Time',
                    data: [30, 40, 35, 50, 49, 60, 70, 91, 125]
                }],
                chart: {
                    type: 'line',
                    height: 300,
                    toolbar: { show: false }
                },
                colors: ['#3498db'],
                stroke: { width: 3, curve: 'smooth' },
                xaxis: {
                    categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep']
                },
                yaxis: {
                    title: { text: 'Response Time (ms)' }
                },
                grid: { borderColor: '#e7e7e7' }
            });
            performanceChart.render();

            // User Growth Chart
            window.userGrowthChart = new ApexCharts(document.querySelector("#userGrowthChart"), {
                series: [{
                    name: 'New Users',
                    data: [45, 52, 38, 24, 33, 26, 21, 20, 6, 8, 15, 10]
                }],
                chart: {
                    type: 'area',
                    height: 250,
                    toolbar: { show: false }
                },
                colors: ['#27ae60'],
                stroke: { width: 2, curve: 'smooth' },
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.3,
                    }
                },
                xaxis: {
                    categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
                }
            });
            userGrowthChart.render();

            // Revenue Chart
            window.revenueChart = new ApexCharts(document.querySelector("#revenueChart"), {
                series: [{
                    name: 'Revenue',
                    data: [31000, 40000, 28000, 51000, 42000, 109000, 100000]
                }],
                chart: {
                    type: 'bar',
                    height: 250,
                    toolbar: { show: false }
                },
                colors: ['#2c3e50'],
                plotOptions: {
                    bar: { borderRadius: 4 }
                },
                xaxis: {
                    categories: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                }
            });
            revenueChart.render();

            // System Health Chart
            window.systemHealthChart = new ApexCharts(document.querySelector("#systemHealthChart"), {
                series: [{
                    name: 'CPU Usage',
                    data: [45, 52, 38, 24, 33, 26, 21, 20, 6, 8, 15, 10]
                }, {
                    name: 'Memory Usage',
                    data: [35, 41, 62, 42, 13, 18, 29, 37, 36, 51, 32, 35]
                }],
                chart: {
                    type: 'line',
                    height: 350,
                    toolbar: { show: false }
                },
                colors: ['#3498db', '#f39c12'],
                stroke: { width: 2, curve: 'smooth' },
                xaxis: {
                    categories: ['12 AM', '2 AM', '4 AM', '6 AM', '8 AM', '10 AM', '12 PM', '2 PM', '4 PM', '6 PM', '8 PM', '10 PM']
                },
                yaxis: {
                    title: { text: 'Usage (%)' },
                    min: 0,
                    max: 100
                }
            });
            systemHealthChart.render();
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load recent activity
                const activityResponse = await API.get('/api/admin/activities');
                if (activityResponse.success) {
                    updateRecentActivity(activityResponse.data);
                }

                // Load system stats
                const statsResponse = await API.get('/api/admin/stats');
                if (statsResponse.success) {
                    updateDashboardStats(statsResponse.data);
                }

                // Load users for user management
                loadUsers();

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showError('Failed to load dashboard data');
            }
        }

        function updateRecentActivity(activities) {
            const container = document.getElementById('recentActivity');
            if (!container) return;

            if (activities.length === 0) {
                container.innerHTML = '<p class="text-center text-muted py-3">No recent activity</p>';
                return;
            }

            let html = '';
            activities.forEach(activity => {
                const time = new Date(activity.timestamp).toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                let icon = 'fa-history';
                let colorClass = '';
                
                switch(activity.type) {
                    case 'login':
                        icon = 'fa-sign-in-alt';
                        colorClass = 'success';
                        break;
                    case 'logout':
                        icon = 'fa-sign-out-alt';
                        colorClass = 'warning';
                        break;
                    case 'error':
                        icon = 'fa-exclamation-circle';
                        colorClass = 'danger';
                        break;
                    case 'update':
                        icon = 'fa-edit';
                        colorClass = 'info';
                        break;
                }

                html += `
                    <div class="recent-activity-item ${colorClass}">
                        <div class="d-flex align-items-start">
                            <i class="fas ${icon} me-2"></i>
                            <div class="flex-grow-1">
                                <strong>${activity.action}</strong>
                                <p class="mb-1 small">${activity.description}</p>
                                <small class="activity-time">${time}</small>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function updateDashboardStats(stats) {
            if (stats.totalUsers) {
                document.getElementById('totalUsers').textContent = stats.totalUsers.toLocaleString();
            }
            if (stats.totalPatients) {
                document.getElementById('totalPatients').textContent = stats.totalPatients.toLocaleString();
            }
            if (stats.todayAppointments) {
                document.getElementById('todayAppointments').textContent = stats.todayAppointments;
            }
            if (stats.monthlyRevenue) {
                document.getElementById('monthlyRevenue').textContent = '$' + stats.monthlyRevenue.toLocaleString();
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Sidebar navigation
            document.querySelectorAll('.admin-sidebar .nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    loadSection(section);
                });
            });

            // Settings tabs
            document.querySelectorAll('#settingsTabs .nav-link').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('#settingsTabs .nav-link').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });

            // Role selection
            document.querySelectorAll('#rolesList .list-group-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('#rolesList .list-group-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    const role = this.getAttribute('data-role');
                    loadPermissions(role);
                });
            });

            // Template selection
            document.querySelectorAll('#templateList .list-group-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('#templateList .list-group-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    const template = this.getAttribute('data-template');
                    loadTemplate(template);
                });
            });

            // Toggle sidebar on mobile
            document.getElementById('sidebarToggle').addEventListener('click', function() {
                document.querySelector('.admin-sidebar').classList.toggle('d-none');
            });

            // Cloud backup toggle
            document.getElementById('enableCloudBackup').addEventListener('change', function() {
                document.getElementById('cloudBackupSettings').style.display = 
                    this.checked ? 'block' : 'none';
            });

            // Maintenance mode toggle
            document.getElementById('maintenanceMode').addEventListener('change', function() {
                const status = this.checked ? 'enabled' : 'disabled';
                showToast(`Maintenance mode ${status}`, this.checked ? 'warning' : 'success');
            });

            // Form submissions
            document.getElementById('generalSettingsForm')?.addEventListener('submit', saveGeneralSettings);
            document.getElementById('emailSettingsForm')?.addEventListener('submit', saveEmailSettings);
            document.getElementById('securitySettingsForm')?.addEventListener('submit', saveSecuritySettings);
            document.getElementById('billingSettingsForm')?.addEventListener('submit', saveBillingSettings);
            document.getElementById('backupSettingsForm')?.addEventListener('submit', saveBackupSettings);
            document.getElementById('emailTemplateForm')?.addEventListener('submit', saveEmailTemplate);
            document.getElementById('profileForm')?.addEventListener('submit', saveProfile);

            // Filter changes
            document.getElementById('userRoleFilter')?.addEventListener('change', filterUsers);
            document.getElementById('userStatusFilter')?.addEventListener('change', filterUsers);
            document.getElementById('userSearch')?.addEventListener('keyup', filterUsers);
            document.getElementById('logTypeFilter')?.addEventListener('change', filterLogs);
            document.getElementById('logLevelFilter')?.addEventListener('change', filterLogs);
            document.getElementById('logDateFilter')?.addEventListener('change', filterLogs);
            document.getElementById('logSearch')?.addEventListener('keyup', filterLogs);
        }

        // Load section
        function loadSection(section) {
            // Hide all sections
            document.querySelectorAll('.dashboard-section').forEach(sec => {
                sec.style.display = 'none';
            });

            // Show selected section
            document.getElementById(section + 'Section').style.display = 'block';

            // Update active nav link
            document.querySelectorAll('.admin-sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-section="${section}"]`).classList.add('active');

            // Update page title
            const titles = {
                'overview': 'Admin Dashboard',
                'users': 'User Management',
                'system-settings': 'System Settings',
                'permissions': 'Permissions Management',
                'backups': 'Backup Management',
                'logs': 'System Logs',
                'email-templates': 'Email Templates',
                'api-keys': 'API Key Management',
                'reports': 'Reports & Analytics',
                'maintenance': 'System Maintenance',
                'system-health': 'System Health Monitor',
                'profile': 'My Profile'
            };
            document.getElementById('pageTitle').textContent = titles[section] || 'Admin Dashboard';

            // Load section-specific data
            switch(section) {
                case 'users':
                    loadUsers();
                    break;
                case 'logs':
                    loadLogs();
                    break;
                case 'system-health':
                    updateSystemHealth();
                    break;
                case 'reports':
                    initializeReportCharts();
                    break;
            }
        }

        // User management functions
        async function loadUsers() {
            try {
                const response = await API.get('/api/admin/users');
                if (response.success) {
                    updateUsersTable(response.data);
                }
            } catch (error) {
                console.error('Error loading users:', error);
                showError('Failed to load users');
            }
        }

        function updateUsersTable(users) {
            const tbody = document.getElementById('usersTableBody');
            if (!tbody) return;

            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center">No users found</td></tr>';
                return;
            }

            let html = '';
            users.forEach(user => {
                const lastLogin = user.last_login ? 
                    new Date(user.last_login).toLocaleString() : 'Never';
                const created = user.created_at ? 
                    new Date(user.created_at).toLocaleDateString() : 'N/A';

                let roleBadge = '';
                switch(user.role) {
                    case 'admin':
                        roleBadge = '<span class="user-role-badge admin">Admin</span>';
                        break;
                    case 'doctor':
                        roleBadge = '<span class="user-role-badge doctor">Doctor</span>';
                        break;
                    case 'nurse':
                        roleBadge = '<span class="user-role-badge nurse">Nurse</span>';
                        break;
                    case 'staff':
                        roleBadge = '<span class="user-role-badge staff">Staff</span>';
                        break;
                    case 'patient':
                        roleBadge = '<span class="user-role-badge patient">Patient</span>';
                        break;
                }

                const statusClass = user.is_active ? 'user-status-active' : 'user-status-inactive';
                const statusText = user.is_active ? 'Active' : 'Inactive';

                html += `
                    <tr>
                        <td>${user.id}</td>
                        <td>
                            <strong>${user.first_name} ${user.last_name}</strong><br>
                            <small class="text-muted">@${user.username}</small>
                        </td>
                        <td>${user.email}</td>
                        <td>${roleBadge}</td>
                        <td><span class="${statusClass}">${statusText}</span></td>
                        <td><small>${lastLogin}</small></td>
                        <td><small>${created}</small></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="editUser(${user.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-warning ms-1" onclick="resetPassword(${user.id})">
                                <i class="fas fa-key"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger ms-1" onclick="toggleUserStatus(${user.id}, ${!user.is_active})">
                                <i class="fas ${user.is_active ? 'fa-ban' : 'fa-check'}"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
            
            // Initialize DataTable if not already initialized
            if (!$.fn.DataTable.isDataTable('#usersTable')) {
                $('#usersTable').DataTable({
                    pageLength: 10,
                    ordering: true,
                    responsive: true
                });
            }
        }

        function filterUsers() {
            const role = document.getElementById('userRoleFilter').value;
            const status = document.getElementById('userStatusFilter').value;
            const search = document.getElementById('userSearch').value.toLowerCase();

            // This would normally make an API call with filters
            // For now, just reload users
            loadUsers();
        }

        function searchUsers() {
            filterUsers();
        }

        async function addUser() {
            Swal.fire({
                title: 'Add New User',
                html: `
                    <div class="text-start">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">First Name</label>
                                <input type="text" id="swalFirstName" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Last Name</label>
                                <input type="text" id="swalLastName" class="form-control" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" id="swalEmail" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Username</label>
                                <input type="text" id="swalUsername" class="form-control" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Role</label>
                                <select id="swalRole" class="form-select" required>
                                    <option value="admin">Administrator</option>
                                    <option value="doctor">Doctor</option>
                                    <option value="nurse">Nurse</option>
                                    <option value="staff">Staff</option>
                                    <option value="patient">Patient</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone</label>
                                <input type="tel" id="swalPhone" class="form-control">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" id="swalPassword" class="form-control" required>
                            <small class="text-muted">Minimum 8 characters with uppercase, lowercase, and number</small>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="swalSendWelcome" class="form-check-input" checked>
                            <label class="form-check-label" for="swalSendWelcome">
                                Send welcome email with credentials
                            </label>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Add User',
                preConfirm: async () => {
                    const userData = {
                        first_name: document.getElementById('swalFirstName').value,
                        last_name: document.getElementById('swalLastName').value,
                        email: document.getElementById('swalEmail').value,
                        username: document.getElementById('swalUsername').value,
                        role: document.getElementById('swalRole').value,
                        phone: document.getElementById('swalPhone').value,
                        password: document.getElementById('swalPassword').value,
                        send_welcome: document.getElementById('swalSendWelcome').checked
                    };

                    // Validate
                    if (!userData.first_name || !userData.last_name || !userData.email || 
                        !userData.username || !userData.password) {
                        Swal.showValidationMessage('Please fill all required fields');
                        return false;
                    }

                    try {
                        const response = await API.post('/api/admin/users', userData);
                        return response.success;
                    } catch (error) {
                        Swal.showValidationMessage('Failed to create user');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Success!', 'User created successfully.', 'success');
                    loadUsers();
                }
            });
        }

        async function editUser(userId) {
            try {
                const response = await API.get(`/api/admin/users/${userId}`);
                if (response.success) {
                    const user = response.data;
                    
                    Swal.fire({
                        title: 'Edit User',
                        html: `
                            <div class="text-start">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">First Name</label>
                                        <input type="text" id="swalEditFirstName" class="form-control" value="${user.first_name}" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Last Name</label>
                                        <input type="text" id="swalEditLastName" class="form-control" value="${user.last_name}" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" id="swalEditEmail" class="form-control" value="${user.email}" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Role</label>
                                        <select id="swalEditRole" class="form-select" required>
                                            <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Administrator</option>
                                            <option value="doctor" ${user.role === 'doctor' ? 'selected' : ''}>Doctor</option>
                                            <option value="nurse" ${user.role === 'nurse' ? 'selected' : ''}>Nurse</option>
                                            <option value="staff" ${user.role === 'staff' ? 'selected' : ''}>Staff</option>
                                            <option value="patient" ${user.role === 'patient' ? 'selected' : ''}>Patient</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" id="swalEditPhone" class="form-control" value="${user.phone || ''}">
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" id="swalEditActive" class="form-check-input" ${user.is_active ? 'checked' : ''}>
                                    <label class="form-check-label" for="swalEditActive">
                                        Account Active
                                    </label>
                                </div>
                            </div>
                        `,
                        showCancelButton: true,
                        confirmButtonText: 'Update User',
                        preConfirm: async () => {
                            const userData = {
                                first_name: document.getElementById('swalEditFirstName').value,
                                last_name: document.getElementById('swalEditLastName').value,
                                email: document.getElementById('swalEditEmail').value,
                                role: document.getElementById('swalEditRole').value,
                                phone: document.getElementById('swalEditPhone').value,
                                is_active: document.getElementById('swalEditActive').checked
                            };

                            try {
                                const response = await API.put(`/api/admin/users/${userId}`, userData);
                                return response.success;
                            } catch (error) {
                                Swal.showValidationMessage('Failed to update user');
                                return false;
                            }
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            Swal.fire('Success!', 'User updated successfully.', 'success');
                            loadUsers();
                        }
                    });
                }
            } catch (error) {
                showError('Failed to load user data');
            }
        }

        async function toggleUserStatus(userId, activate) {
            const action = activate ? 'activate' : 'deactivate';
            const confirmText = activate ? 
                'Are you sure you want to activate this user?' : 
                'Are you sure you want to deactivate this user?';

            Swal.fire({
                title: 'Confirm',
                text: confirmText,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: `Yes, ${action}`,
                cancelButtonText: 'Cancel'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        const response = await API.put(`/api/admin/users/${userId}/status`, {
                            is_active: activate
                        });
                        
                        if (response.success) {
                            showToast(`User ${action}d successfully`, 'success');
                            loadUsers();
                        } else {
                            showError('Failed to update user status');
                        }
                    } catch (error) {
                        showError('Failed to update user status');
                    }
                }
            });
        }

        async function resetPassword(userId) {
            Swal.fire({
                title: 'Reset Password',
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <label class="form-label">New Password</label>
                            <input type="password" id="swalNewPassword" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Confirm Password</label>
                            <input type="password" id="swalConfirmPassword" class="form-control" required>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="swalForceReset" class="form-check-input" checked>
                            <label class="form-check-label" for="swalForceReset">
                                Force password reset on next login
                            </label>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Reset Password',
                preConfirm: async () => {
                    const newPassword = document.getElementById('swalNewPassword').value;
                    const confirmPassword = document.getElementById('swalConfirmPassword').value;
                    const forceReset = document.getElementById('swalForceReset').checked;

                    if (newPassword !== confirmPassword) {
                        Swal.showValidationMessage('Passwords do not match');
                        return false;
                    }

                    if (newPassword.length < 8) {
                        Swal.showValidationMessage('Password must be at least 8 characters');
                        return false;
                    }

                    try {
                        const response = await API.post(`/api/admin/users/${userId}/reset-password`, {
                            new_password: newPassword,
                            force_reset: forceReset
                        });
                        return response.success;
                    } catch (error) {
                        Swal.showValidationMessage('Failed to reset password');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Success!', 'Password reset successfully.', 'success');
                }
            });
        }

        // Settings functions
        async function saveGeneralSettings(e) {
            e.preventDefault();
            
            const settings = {
                hospital_name: document.getElementById('hospitalName').value,
                hospital_phone: document.getElementById('hospitalPhone').value,
                hospital_address: document.getElementById('hospitalAddress').value,
                hospital_email: document.getElementById('hospitalEmail').value,
                hospital_website: document.getElementById('hospitalWebsite').value,
                timezone: document.getElementById('systemTimezone').value,
                date_format: document.getElementById('dateFormat').value,
                time_format: document.getElementById('timeFormat').value,
                language: document.getElementById('systemLanguage').value
            };

            try {
                const response = await API.post('/api/admin/settings/general', settings);
                if (response.success) {
                    showToast('General settings saved successfully', 'success');
                } else {
                    showError('Failed to save settings');
                }
            } catch (error) {
                showError('Failed to save settings');
            }
        }

        async function saveEmailSettings(e) {
            e.preventDefault();
            
            const settings = {
                smtp_host: document.getElementById('smtpHost').value,
                smtp_port: document.getElementById('smtpPort').value,
                smtp_username: document.getElementById('smtpUsername').value,
                smtp_password: document.getElementById('smtpPassword').value,
                smtp_encryption: document.getElementById('smtpEncryption').value,
                from_email: document.getElementById('fromEmail').value,
                enable_notifications: document.getElementById('enableEmailNotifications').checked,
                send_welcome_email: document.getElementById('sendWelcomeEmail').checked,
                send_appointment_reminders: document.getElementById('sendAppointmentReminders').checked,
                send_billing_notifications: document.getElementById('sendBillingNotifications').checked
            };

            try {
                const response = await API.post('/api/admin/settings/email', settings);
                if (response.success) {
                    showToast('Email settings saved successfully', 'success');
                } else {
                    showError('Failed to save email settings');
                }
            } catch (error) {
                showError('Failed to save email settings');
            }
        }

        async function saveSecuritySettings(e) {
            e.preventDefault();
            
            const settings = {
                session_timeout: document.getElementById('sessionTimeout').value,
                max_login_attempts: document.getElementById('maxLoginAttempts').value,
                lockout_duration: document.getElementById('lockoutDuration').value,
                two_factor_auth: document.getElementById('twoFactorAuth').value,
                require_strong_passwords: document.getElementById('requireStrongPasswords').checked,
                min_password_length: document.getElementById('minPasswordLength').value,
                password_expiry: document.getElementById('passwordExpiry').value,
                require_uppercase: document.getElementById('requireUppercase').checked,
                require_lowercase: document.getElementById('requireLowercase').checked,
                require_numbers: document.getElementById('requireNumbers').checked,
                require_special_chars: document.getElementById('requireSpecialChars').checked,
                enable_ip_whitelist: document.getElementById('enableIpWhitelist').checked,
                allowed_ips: document.getElementById('allowedIps').value
            };

            try {
                const response = await API.post('/api/admin/settings/security', settings);
                if (response.success) {
                    showToast('Security settings saved successfully', 'success');
                } else {
                    showError('Failed to save security settings');
                }
            } catch (error) {
                showError('Failed to save security settings');
            }
        }

        async function saveBillingSettings(e) {
            e.preventDefault();
            
            const settings = {
                currency: document.getElementById('currency').value,
                currency_symbol: document.getElementById('currencySymbol').value,
                tax_rate: document.getElementById('taxRate').value,
                invoice_due_days: document.getElementById('invoiceDueDays').value,
                payment_gateway: document.getElementById('paymentGateway').value,
                payment_test_mode: document.getElementById('paymentTestMode').value === 'true',
                stripe_public_key: document.getElementById('stripePublicKey').value,
                stripe_secret_key: document.getElementById('stripeSecretKey').value,
                enable_online_payments: document.getElementById('enableOnlinePayments').checked,
                enable_invoice_generation: document.getElementById('enableInvoiceGeneration').checked,
                enable_payment_reminders: document.getElementById('enablePaymentReminders').checked,
                enable_late_fees: document.getElementById('enableLateFees').checked,
                late_fee_percentage: document.getElementById('lateFeePercentage').value,
                late_fee_grace_period: document.getElementById('lateFeeGracePeriod').value
            };

            try {
                const response = await API.post('/api/admin/settings/billing', settings);
                if (response.success) {
                    showToast('Billing settings saved successfully', 'success');
                } else {
                    showError('Failed to save billing settings');
                }
            } catch (error) {
                showError('Failed to save billing settings');
            }
        }

        async function saveBackupSettings(e) {
            e.preventDefault();
            
            const settings = {
                backup_frequency: document.getElementById('backupFrequency').value,
                backup_time: document.getElementById('backupTime').value,
                backup_retention: document.getElementById('backupRetention').value,
                max_backup_size: document.getElementById('maxBackupSize').value,
                compress_backups: document.getElementById('compressBackups').checked,
                backup_database: document.getElementById('backupDatabase').checked,
                backup_files: document.getElementById('backupFiles').checked,
                enable_cloud_backup: document.getElementById('enableCloudBackup').checked,
                aws_access_key: document.getElementById('awsAccessKey').value,
                aws_secret_key: document.getElementById('awsSecretKey').value,
                s3_bucket_name: document.getElementById('s3BucketName').value,
                s3_region: document.getElementById('s3Region').value
            };

            try {
                const response = await API.post('/api/admin/settings/backup', settings);
                if (response.success) {
                    showToast('Backup settings saved successfully', 'success');
                } else {
                    showError('Failed to save backup settings');
                }
            } catch (error) {
                showError('Failed to save backup settings');
            }
        }

        // Permission management
        function loadPermissions(role) {
            document.getElementById('currentRole').textContent = 
                role.charAt(0).toUpperCase() + role.slice(1) + ' Permissions';
            
            // Load permissions for role (this would normally come from API)
            const permissions = getDefaultPermissions(role);
            updatePermissionToggles(permissions);
        }

        function getDefaultPermissions(role) {
            const defaultPermissions = {
                admin: {
                    create_users: true,
                    edit_users: true,
                    delete_users: true,
                    view_users: true,
                    create_patients: true,
                    edit_patients: true,
                    view_medical: true,
                    edit_medical: true,
                    create_invoices: true,
                    process_payments: true,
                    view_financial: true,
                    generate_reports: true,
                    system_settings: true,
                    backup_manage: true,
                    view_logs: true,
                    api_access: true
                },
                doctor: {
                    create_users: false,
                    edit_users: false,
                    delete_users: false,
                    view_users: true,
                    create_patients: true,
                    edit_patients: true,
                    view_medical: true,
                    edit_medical: true,
                    create_invoices: false,
                    process_payments: false,
                    view_financial: false,
                    generate_reports: true,
                    system_settings: false,
                    backup_manage: false,
                    view_logs: false,
                    api_access: false
                },
                nurse: {
                    create_users: false,
                    edit_users: false,
                    delete_users: false,
                    view_users: true,
                    create_patients: true,
                    edit_patients: false,
                    view_medical: true,
                    edit_medical: true,
                    create_invoices: false,
                    process_payments: false,
                    view_financial: false,
                    generate_reports: false,
                    system_settings: false,
                    backup_manage: false,
                    view_logs: false,
                    api_access: false
                },
                staff: {
                    create_users: false,
                    edit_users: false,
                    delete_users: false,
                    view_users: true,
                    create_patients: true,
                    edit_patients: false,
                    view_medical: false,
                    edit_medical: false,
                    create_invoices: true,
                    process_payments: true,
                    view_financial: true,
                    generate_reports: false,
                    system_settings: false,
                    backup_manage: false,
                    view_logs: false,
                    api_access: false
                },
                patient: {
                    create_users: false,
                    edit_users: false,
                    delete_users: false,
                    view_users: false,
                    create_patients: false,
                    edit_patients: false,
                    view_medical: true,
                    edit_medical: false,
                    create_invoices: false,
                    process_payments: true,
                    view_financial: true,
                    generate_reports: false,
                    system_settings: false,
                    backup_manage: false,
                    view_logs: false,
                    api_access: false
                }
            };
            
            return defaultPermissions[role] || defaultPermissions.patient;
        }

        function updatePermissionToggles(permissions) {
            for (const [key, value] of Object.entries(permissions)) {
                const checkbox = document.getElementById(`perm_${key}`);
                if (checkbox) {
                    checkbox.checked = value;
                }
            }
        }

        async function savePermissions() {
            const role = document.querySelector('#rolesList .active').getAttribute('data-role');
            const permissions = {};
            
            document.querySelectorAll('.permission-toggle input[type="checkbox"]').forEach(checkbox => {
                const permissionId = checkbox.id.replace('perm_', '');
                permissions[permissionId] = checkbox.checked;
            });

            try {
                const response = await API.post(`/api/admin/permissions/${role}`, { permissions });
                if (response.success) {
                    showToast('Permissions saved successfully', 'success');
                } else {
                    showError('Failed to save permissions');
                }
            } catch (error) {
                showError('Failed to save permissions');
            }
        }

        // Backup management
        async function createBackup() {
            Swal.fire({
                title: 'Create Backup',
                text: 'This will create a full system backup. Continue?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Create Backup',
                showLoaderOnConfirm: true,
                preConfirm: async () => {
                    try {
                        const response = await API.post('/api/admin/backups/create');
                        return response;
                    } catch (error) {
                        Swal.showValidationMessage('Backup creation failed');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Success!', 'Backup created successfully.', 'success');
                    // Refresh backup list
                    loadBackupList();
                }
            });
        }

        async function scheduleBackup() {
            Swal.fire({
                title: 'Schedule Backup',
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <label class="form-label">Backup Type</label>
                            <select class="form-select" id="backupType">
                                <option value="full">Full System Backup</option>
                                <option value="database">Database Only</option>
                                <option value="files">Files Only</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Schedule Time</label>
                            <input type="time" class="form-control" id="scheduleTime" value="02:00">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Repeat</label>
                            <select class="form-select" id="repeatSchedule">
                                <option value="once">Once</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Schedule Backup',
                preConfirm: async () => {
                    const backupData = {
                        type: document.getElementById('backupType').value,
                        time: document.getElementById('scheduleTime').value,
                        repeat: document.getElementById('repeatSchedule').value
                    };

                    try {
                        const response = await API.post('/api/admin/backups/schedule', backupData);
                        return response.success;
                    } catch (error) {
                        Swal.showValidationMessage('Failed to schedule backup');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Success!', 'Backup scheduled successfully.', 'success');
                }
            });
        }

        function loadBackupList() {
            // This would load backup list from API
            console.log('Loading backup list...');
        }

        // Log management
        async function loadLogs() {
            try {
                const response = await API.get('/api/admin/logs');
                if (response.success) {
                    updateLogsTable(response.data);
                }
            } catch (error) {
                console.error('Error loading logs:', error);
                showError('Failed to load logs');
            }
        }

        function updateLogsTable(logs) {
            const tbody = document.getElementById('logsTableBody');
            if (!tbody) return;

            if (logs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">No logs found</td></tr>';
                return;
            }

            let html = '';
            logs.forEach(log => {
                const timestamp = new Date(log.timestamp).toLocaleString();
                
                let levelBadge = '';
                switch(log.level) {
                    case 'info':
                        levelBadge = '<span class="badge bg-info">Info</span>';
                        break;
                    case 'warning':
                        levelBadge = '<span class="badge bg-warning">Warning</span>';
                        break;
                    case 'error':
                        levelBadge = '<span class="badge bg-danger">Error</span>';
                        break;
                    case 'critical':
                        levelBadge = '<span class="badge bg-dark">Critical</span>';
                        break;
                }

                html += `
                    <tr>
                        <td><small>${timestamp}</small></td>
                        <td>${log.type}</td>
                        <td>${levelBadge}</td>
                        <td>${log.user || 'System'}</td>
                        <td><small>${log.ip_address || 'N/A'}</small></td>
                        <td>${log.message}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewLogDetails('${log.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
            
            // Initialize DataTable if not already initialized
            if (!$.fn.DataTable.isDataTable('#logsTable')) {
                $('#logsTable').DataTable({
                    pageLength: 25,
                    ordering: true,
                    responsive: true
                });
            }
        }

        function filterLogs() {
            const type = document.getElementById('logTypeFilter').value;
            const level = document.getElementById('logLevelFilter').value;
            const date = document.getElementById('logDateFilter').value;
            const search = document.getElementById('logSearch').value.toLowerCase();

            // This would normally make an API call with filters
            loadLogs();
        }

        async function exportLogs() {
            try {
                const response = await API.get('/api/admin/logs/export');
                if (response.success) {
                    // Create download link
                    const blob = new Blob([JSON.stringify(response.data, null, 2)], { type: 'application/json' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `logs-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    showToast('Logs exported successfully', 'success');
                }
            } catch (error) {
                showError('Failed to export logs');
            }
        }

        async function clearLogs() {
            Swal.fire({
                title: 'Clear All Logs',
                text: 'This will permanently delete all system logs. Continue?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, clear logs',
                confirmButtonColor: '#dc3545'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        const response = await API.delete('/api/admin/logs');
                        if (response.success) {
                            Swal.fire('Cleared!', 'All logs have been cleared.', 'success');
                            loadLogs();
                        } else {
                            showError('Failed to clear logs');
                        }
                    } catch (error) {
                        showError('Failed to clear logs');
                    }
                }
            });
        }

        // Email templates
        function loadTemplate(template) {
            const templates = {
                'welcome': {
                    title: 'Welcome Email Template',
                    subject: 'Welcome to Hospital Management System',
                    content: `... welcome email HTML ...`
                },
                'password-reset': {
                    title: 'Password Reset Template',
                    subject: 'Password Reset Request',
                    content: `... password reset HTML ...`
                },
                'appointment-reminder': {
                    title: 'Appointment Reminder Template',
                    subject: 'Appointment Reminder',
                    content: `... appointment reminder HTML ...`
                },
                'invoice': {
                    title: 'Invoice Notification Template',
                    subject: 'New Invoice Available',
                    content: `... invoice notification HTML ...`
                },
                'billing': {
                    title: 'Billing Notification Template',
                    subject: 'Billing Update',
                    content: `... billing notification HTML ...`
                }
            };

            const templateData = templates[template];
            if (templateData) {
                document.getElementById('templateTitle').textContent = templateData.title;
                document.getElementById('emailSubject').value = templateData.subject;
                document.getElementById('emailContent').value = templateData.content;
            }
        }

        async function saveEmailTemplate(e) {
            e.preventDefault();
            
            const template = document.querySelector('#templateList .active').getAttribute('data-template');
            const templateData = {
                subject: document.getElementById('emailSubject').value,
                content: document.getElementById('emailContent').value,
                plain_text: document.getElementById('plainTextContent').value,
                is_active: document.getElementById('emailTemplateActive').checked
            };

            try {
                const response = await API.post(`/api/admin/email-templates/${template}`, templateData);
                if (response.success) {
                    showToast('Template saved successfully', 'success');
                } else {
                    showError('Failed to save template');
                }
            } catch (error) {
                showError('Failed to save template');
            }
        }

        function previewEmail() {
            const content = document.getElementById('emailContent').value;
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(content);
            previewWindow.document.close();
        }

        async function testEmail() {
            Swal.fire({
                title: 'Send Test Email',
                input: 'email',
                inputLabel: 'Enter email address to send test',
                inputPlaceholder: 'test@example.com',
                showCancelButton: true,
                confirmButtonText: 'Send Test',
                preConfirm: async (email) => {
                    if (!email) {
                        Swal.showValidationMessage('Please enter an email address');
                        return false;
                    }

                    try {
                        const response = await API.post('/api/admin/email-templates/test', {
                            email: email,
                            template: document.querySelector('#templateList .active').getAttribute('data-template')
                        });
                        return response.success;
                    } catch (error) {
                        Swal.showValidationMessage('Failed to send test email');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Success!', 'Test email sent successfully.', 'success');
                }
            });
        }

        // API Key management
        async function generateApiKey() {
            Swal.fire({
                title: 'Generate API Key',
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <label class="form-label">Key Name</label>
                            <input type="text" id="apiKeyName" class="form-control" placeholder="e.g., Production API Key" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Expiration</label>
                            <select class="form-select" id="apiKeyExpiration">
                                <option value="30">30 days</option>
                                <option value="90">90 days</option>
                                <option value="365">1 year</option>
                                <option value="never" selected>Never expires</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Permissions</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permRead" checked>
                                <label class="form-check-label" for="permRead">
                                    Read access
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permWrite">
                                <label class="form-check-label" for="permWrite">
                                    Write access
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permDelete">
                                <label class="form-check-label" for="permDelete">
                                    Delete access
                                </label>
                            </div>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Generate Key',
                preConfirm: async () => {
                    const keyData = {
                        name: document.getElementById('apiKeyName').value,
                        expiration: document.getElementById('apiKeyExpiration').value,
                        permissions: {
                            read: document.getElementById('permRead').checked,
                            write: document.getElementById('permWrite').checked,
                            delete: document.getElementById('permDelete').checked
                        }
                    };

                    if (!keyData.name) {
                        Swal.showValidationMessage('Please enter a key name');
                        return false;
                    }

                    try {
                        const response = await API.post('/api/admin/api-keys', keyData);
                        return response;
                    } catch (error) {
                        Swal.showValidationMessage('Failed to generate API key');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const apiKey = result.value.data.key;
                    Swal.fire({
                        title: 'API Key Generated',
                        html: `
                            <div class="text-start">
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <strong>Important:</strong> Copy this key now. You won't be able to see it again.
                                </div>
                                <div class="api-key-display">
                                    <code>${apiKey}</code>
                                </div>
                            </div>
                        `,
                        confirmButtonText: 'Copy to Clipboard'
                    }).then(() => {
                        navigator.clipboard.writeText(apiKey);
                        showToast('API key copied to clipboard', 'success');
                        // Refresh API keys list
                        loadApiKeys();
                    });
                }
            });
        }

        function copyApiKey(button) {
            const apiKey = button.closest('.api-key-display').querySelector('code').textContent;
            navigator.clipboard.writeText(apiKey).then(() => {
                showToast('API key copied to clipboard', 'success');
            });
        }

        async function revokeApiKey(button) {
            Swal.fire({
                title: 'Revoke API Key',
                text: 'This will permanently revoke this API key. Continue?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Revoke Key',
                confirmButtonColor: '#dc3545'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    const keyElement = button.closest('.api-key-display');
                    const keyName = keyElement.querySelector('strong').textContent;
                    
                    try {
                        const response = await API.delete(`/api/admin/api-keys/${encodeURIComponent(keyName)}`);
                        if (response.success) {
                            keyElement.remove();
                            showToast('API key revoked successfully', 'success');
                        } else {
                            showError('Failed to revoke API key');
                        }
                    } catch (error) {
                        showError('Failed to revoke API key');
                    }
                }
            });
        }

        // Report functions
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const period = document.getElementById('reportPeriod').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;

            // Show loading
            const content = document.getElementById('reportContent');
            content.innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Generating report...</span>
                    </div>
                    <p class="mt-3">Generating ${reportType} report...</p>
                </div>
            `;

            // Simulate API call
            setTimeout(() => {
                content.innerHTML = `
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <i class="fas fa-chart-bar me-2"></i>${reportType.charAt(0).toUpperCase() + reportType.slice(1)} Report
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="chart-container">
                                        <div id="reportChart"></div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <h5>Summary</h5>
                                    <div class="admin-stat-card mb-3">
                                        <div class="admin-stat-number">$12,450</div>
                                        <div class="admin-stat-label">Total Revenue</div>
                                    </div>
                                    <div class="admin-stat-card success mb-3">
                                        <div class="admin-stat-number">245</div>
                                        <div class="admin-stat-label">Total Patients</div>
                                    </div>
                                    <div class="admin-stat-card warning">
                                        <div class="admin-stat-number">89%</div>
                                        <div class="admin-stat-label">Satisfaction Rate</div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <h5>Detailed Data</h5>
                                <div class="table-responsive">
                                    <table class="table admin-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Patients</th>
                                                <th>Appointments</th>
                                                <th>Revenue</th>
                                                <th>Expenses</th>
                                                <th>Profit</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>${new Date().toLocaleDateString()}</td>
                                                <td>42</td>
                                                <td>56</td>
                                                <td>$8,450</td>
                                                <td>$2,150</td>
                                                <td>$6,300</td>
                                            </tr>
                                            <!-- More rows would go here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Initialize report chart
                new ApexCharts(document.querySelector("#reportChart"), {
                    series: [{
                        name: 'Revenue',
                        data: [30, 40, 35, 50, 49, 60, 70, 91, 125]
                    }],
                    chart: { type: 'line', height: 300, toolbar: { show: false } },
                    colors: ['#3498db'],
                    stroke: { width: 3, curve: 'smooth' },
                    xaxis: { categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'] }
                }).render();
                
            }, 1500);
        }

        function exportReport() {
            showToast('Report exported to Excel', 'success');
        }

        function printReport() {
            window.print();
        }

        // Maintenance functions
        async function optimizeDatabase() {
            Swal.fire({
                title: 'Optimize Database',
                text: 'This will optimize all database tables. Continue?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Optimize',
                showLoaderOnConfirm: true,
                preConfirm: async () => {
                    try {
                        const response = await API.post('/api/admin/maintenance/optimize-database');
                        return response;
                    } catch (error) {
                        Swal.showValidationMessage('Optimization failed');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Success!', 'Database optimized successfully.', 'success');
                }
            });
        }

        async function clearCache() {
            Swal.fire({
                title: 'Clear System Cache',
                text: 'This will clear all cached data. Continue?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Clear Cache',
                showLoaderOnConfirm: true,
                preConfirm: async () => {
                    try {
                        const response = await API.post('/api/admin/maintenance/clear-cache');
                        return response;
                    } catch (error) {
                        Swal.showValidationMessage('Cache clearing failed');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Success!', 'Cache cleared successfully.', 'success');
                }
            });
        }

        async function updateStatistics() {
            Swal.fire({
                title: 'Update Statistics',
                text: 'This will update database statistics. Continue?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Update',
                showLoaderOnConfirm: true,
                preConfirm: async () => {
                    try {
                        const response = await API.post('/api/admin/maintenance/update-statistics');
                        return response;
                    } catch (error) {
                        Swal.showValidationMessage('Update failed');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Success!', 'Statistics updated successfully.', 'success');
                }
            });
        }

        async function checkForUpdates() {
            Swal.fire({
                title: 'Checking for updates...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                    
                    // Simulate API call
                    setTimeout(() => {
                        Swal.fire({
                            title: 'Update Available',
                            html: `
                                <div class="text-start">
                                    <p><strong>Version 2.1.0</strong> is available</p>
                                    <p>Current version: 2.0.5</p>
                                    <div class="alert alert-info">
                                        <h6>What's New:</h6>
                                        <ul>
                                            <li>New dashboard widgets</li>
                                            <li>Enhanced security features</li>
                                            <li>Bug fixes and performance improvements</li>
                                        </ul>
                                    </div>
                                </div>
                            `,
                            showCancelButton: true,
                            confirmButtonText: 'Update Now',
                            showLoaderOnConfirm: true,
                            preConfirm: async () => {
                                try {
                                    const response = await API.post('/api/admin/maintenance/update');
                                    return response;
                                } catch (error) {
                                    Swal.showValidationMessage('Update failed');
                                    return false;
                                }
                            }
                        }).then((result) => {
                            if (result.isConfirmed) {
                                Swal.fire('Success!', 'System updated successfully. Please restart.', 'success');
                            }
                        });
                    }, 2000);
                }
            });
        }

        async function runHealthChecks() {
            const results = document.getElementById('healthCheckResults');
            results.innerHTML = `
                <div class="text-center py-3">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Running health checks...</span>
                    </div>
                    <p class="mt-2">Running system health checks...</p>
                </div>
            `;

            // Simulate API call
            setTimeout(() => {
                results.innerHTML = `
                    <div class="alert alert-success mb-2">
                        <i class="fas fa-check-circle me-2"></i>
                        Database Connection: <strong>OK</strong>
                    </div>
                    <div class="alert alert-success mb-2">
                        <i class="fas fa-check-circle me-2"></i>
                        File Permissions: <strong>OK</strong>
                    </div>
                    <div class="alert alert-success mb-2">
                        <i class="fas fa-check-circle me-2"></i>
                        Disk Space: <strong>75% used (Healthy)</strong>
                    </div>
                    <div class="alert alert-success mb-2">
                        <i class="fas fa-check-circle me-2"></i>
                        Email Service: <strong>OK</strong>
                    </div>
                    <div class="alert alert-success mb-2">
                        <i class="fas fa-check-circle me-2"></i>
                        Backup Service: <strong>OK</strong>
                    </div>
                `;
                showToast('Health checks completed successfully', 'success');
            }, 2000);
        }

        async function updateMaintenanceMode() {
            const enabled = document.getElementById('maintenanceMode').checked;
            const message = document.getElementById('maintenanceMessage').value;

            try {
                const response = await API.post('/api/admin/maintenance/mode', {
                    enabled: enabled,
                    message: message
                });
                
                if (response.success) {
                    showToast(`Maintenance mode ${enabled ? 'enabled' : 'disabled'}`, 'success');
                } else {
                    showError('Failed to update maintenance mode');
                }
            } catch (error) {
                showError('Failed to update maintenance mode');
            }
        }

        // System health functions
        function updateSystemHealth() {
            // Update CPU usage
            const cpuUsage = Math.floor(Math.random() * 30) + 40; // 40-70%
            document.getElementById('cpuUsage').textContent = cpuUsage + '%';
            
            // Update memory usage
            const memoryUsage = Math.floor(Math.random() * 20) + 60; // 60-80%
            document.getElementById('memoryUsage').textContent = memoryUsage + '%';
            
            // Update chart data
            systemHealthChart.updateSeries([{
                name: 'CPU Usage',
                data: Array.from({length: 12}, () => Math.floor(Math.random() * 30) + 40)
            }, {
                name: 'Memory Usage',
                data: Array.from({length: 12}, () => Math.floor(Math.random() * 20) + 60)
            }]);
        }

        async function runSecurityScan() {
            Swal.fire({
                title: 'Running Security Scan',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                    
                    // Simulate scan
                    setTimeout(() => {
                        Swal.fire({
                            title: 'Security Scan Complete',
                            html: `
                                <div class="text-start">
                                    <div class="alert alert-success">
                                        <i class="fas fa-shield-alt"></i>
                                        <strong>Overall Security Score: 92/100</strong>
                                    </div>
                                    <h6>Scan Results:</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success me-2"></i>SSL Certificate: Valid</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Firewall: Active</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Brute Force Protection: Enabled</li>
                                        <li><i class="fas fa-exclamation-triangle text-warning me-2"></i>Password Policy: Could be stronger</li>
                                        <li><i class="fas fa-check text-success me-2"></i>SQL Injection Protection: Active</li>
                                    </ul>
                                </div>
                            `,
                            confirmButtonText: 'Close'
                        });
                    }, 3000);
                }
            });
        }

        // Profile functions
        async function saveProfile(e) {
            e.preventDefault();
            
            const profileData = {
                first_name: document.getElementById('profileFirstName').value,
                last_name: document.getElementById('profileLastName').value,
                email: document.getElementById('profileEmail').value,
                phone: document.getElementById('profilePhone').value,
                address: document.getElementById('profileAddress').value,
                timezone: document.getElementById('profileTimezone').value,
                language: document.getElementById('profileLanguage').value
            };

            try {
                const response = await API.put('/api/admin/profile', profileData);
                if (response.success) {
                    showToast('Profile updated successfully', 'success');
                    // Update UI
                    document.getElementById('adminName').textContent = `${profileData.first_name} ${profileData.last_name}`;
                    document.getElementById('adminEmail').textContent = profileData.email;
                    document.getElementById('userName').textContent = `${profileData.first_name} ${profileData.last_name}`;
                } else {
                    showError('Failed to update profile');
                }
            } catch (error) {
                showError('Failed to update profile');
            }
        }

        async function updateProfilePicture() {
            const fileInput = document.getElementById('profilePicture');
            if (!fileInput.files.length) {
                showError('Please select a file');
                return;
            }

            const formData = new FormData();
            formData.append('avatar', fileInput.files[0]);

            try {
                const response = await API.upload('/api/admin/profile/avatar', formData);
                if (response.success) {
                    showToast('Profile picture updated successfully', 'success');
                    // Update avatar image
                    const avatar = document.querySelector('.admin-profile-img');
                    avatar.src = response.data.avatar_url + '?t=' + Date.now();
                } else {
                    showError('Failed to update profile picture');
                }
            } catch (error) {
                showError('Failed to update profile picture');
            }
        }

        async function changePassword() {
            Swal.fire({
                title: 'Change Password',
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <label class="form-label">Current Password</label>
                            <input type="password" id="currentPassword" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">New Password</label>
                            <input type="password" id="newPassword" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Confirm New Password</label>
                            <input type="password" id="confirmPassword" class="form-control" required>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Change Password',
                preConfirm: async () => {
                    const currentPassword = document.getElementById('currentPassword').value;
                    const newPassword = document.getElementById('newPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;

                    if (newPassword !== confirmPassword) {
                        Swal.showValidationMessage('Passwords do not match');
                        return false;
                    }

                    if (newPassword.length < 8) {
                        Swal.showValidationMessage('Password must be at least 8 characters');
                        return false;
                    }

                    try {
                        const response = await API.post('/api/admin/profile/change-password', {
                            current_password: currentPassword,
                            new_password: newPassword
                        });
                        return response.success;
                    } catch (error) {
                        Swal.showValidationMessage('Failed to change password');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Success!', 'Password changed successfully.', 'success');
                }
            });
        }

        async function enableTwoFactor() {
            Swal.fire({
                title: 'Two-Factor Authentication',
                html: `
                    <div class="text-start">
                        <p>Two-factor authentication adds an extra layer of security to your account.</p>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="enable2FA">
                            <label class="form-check-label" for="enable2FA">
                                Enable Two-Factor Authentication
                            </label>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Save Settings',
                preConfirm: async () => {
                    const enabled = document.getElementById('enable2FA').checked;
                    
                    try {
                        const response = await API.post('/api/admin/profile/two-factor', {
                            enabled: enabled
                        });
                        return response.success;
                    } catch (error) {
                        Swal.showValidationMessage('Failed to update 2FA settings');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Success!', 'Two-factor settings updated.', 'success');
                }
            });
        }

        // System alerts
        function checkSystemAlerts() {
            // This would check for system alerts via API
            const alertCount = 3;
            document.getElementById('alertCount').textContent = alertCount;
            document.getElementById('backupCount').textContent = 2;
            document.getElementById('logCount').textContent = 24;
            document.getElementById('apiKeyCount').textContent = 3;
        }

        // Helper functions
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-bg-${type} border-0`;
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            const container = document.createElement('div');
            container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
            container.appendChild(toast);
            document.body.appendChild(container);
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            toast.addEventListener('hidden.bs.toast', () => {
                container.remove();
            });
        }

        function showError(message) {
            showToast(message, 'danger');
        }

        function updateTimestamps() {
            // Update relative timestamps
            document.querySelectorAll('.activity-time').forEach(element => {
                // Update relative time display
            });
        }

        // Logout function
        async function logout() {
            Swal.fire({
                title: 'Logout',
                text: 'Are you sure you want to logout?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Logout',
                confirmButtonColor: '#dc3545'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        await API.post('/api/auth/logout');
                    } catch (error) {
                        // Ignore errors
                    }
                    
                    // Clear local storage and redirect
                    localStorage.clear();
                    sessionStorage.clear();
                    window.location.href = '../../views/auth/login.html';
                }
            });
        }

        // Initialize dashboard
        loadDashboardData();
    </script>
</body>
</html>